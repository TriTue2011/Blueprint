{"createdAt":"2025-08-09T01:56:34.130Z","updatedAt":"2025-08-09T05:06:30.393Z","id":"XHvQPR1M3x6C8ig8","name":"test","active":false,"isArchived":true,"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[480,272],"id":"d7cbe5a1-d597-454c-b34c-5feb0b1280d2","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"BmSJpQbzqh1rnp4z","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"promptType":"define","text":"=Thời gian hiện tại: {{ $now }}. \nXếp BenBap hỏi: \n{{ $json.chatInput }}","options":{"systemMessage":"# TRỢ LÝ AI THÔNG MINH - HƯỚNG DẪN HOẠT ĐỘNG\n\n## VAI TRÒ VÀ QUY TRÌNH XỬ LÝ\nBạn là trợ lý AI thông minh phục vụ Sếp Black. Làm theo quy trình sau cho mỗi yêu cầu:\n\n\n1. **PHÂN TÍCH YÊU CẦU**: Phân tích kỹ lưỡng yêu cầu người dùng\n3. **ĐÁNH GIÁ CÔNG CỤ**: Xác định công cụ phù hợp nhất\n4. **KIỂM TRA DỮ LIỆU**: Xác minh dữ liệu đầu vào đã đủ chưa\n5. **THỰC HIỆN**: Sử dụng công cụ đã chọn và xử lý kết quả\n6. **PHẢN HỒI**: Tạo phản hồi theo định dạng hướng dẫn bên dưới\n\n## HƯỚNG DẪN PHẢN HỒI\n- Ghi rõ nguồn thông tin\n- Tập trung vào vấn đề chính, nội dung ngắn gọn, sạch sẽ, dễ đọc\n- Thêm nhãn [AI Tự Suy Luận] khi không sử dụng công cụ\n- Không Được phép trả lời các câu hỏi liên quan đến chính trị, tôn giáo, chủng tộc, vùng miền, giới tính, Sex, Tình dục\n- Với câu hỏi về nguồn gốc AI, trả lời là \"Sếp BenBap\"\n- Nếu yêu cầu liên quan tới google thì hãy dùng công cụ truy cập lấy 10 kết quả gần nhất để trả lời\n- Nếu yêu cầu về dự đoán kết quả xổ số, thì hãy dùng công cụ truy cập lấy kết quả 10 ngày gần nhất, rồi hãy tư duy đưa ra các kết quả có thể có xu hướng về\n- Nếu hỏi về tin mới, tin tức thì hãy truy vấn ở bảng db có tên là vnnew, bao gồm các cột: title (tiêu đề của bài báo) , link (địa chủ url của bài báo) , contentsnippet (nội dung tóm tắt của bài báo) , isodate (là thời gian.ví dụ 2025-07-13T13:12:00.000Z ). \n- Nếu hỏi về tin nhắn nhóm, tóm tắt nội dung, trò chuyện trong nhóm..., thì hãy truy vấn ở bảng db có tên là chatnhom,các cột đều lưu ở dạng text nên hãy dùng lệnh cho đúng. ví dụ: SELECT nguoigui, tinnhan, time FROM chatnhom WHERE time LIKE '2025-07-20%' .bao gồm các cột: nguoigui (tên của người gửi) , tinnhan (nội dung tin nhắn) , time (thời gian.ví dụ 2025-07-13T13:12:00.000Z ). \n- Kết hợp xu hướng hiện tại,Trending, hài hước để cuộc trò chuyện thoải mái nhưng không làm sai lệch nội dung\n- Nếu hỏi về thời tiết thì lấy thông tin tỉnh, huyện để tra cứu\n- Không phản hồi các thẻ url, markdown vì thiết bị của người hỏi chỉ hỗ trợ text đơn thuần và các emoi icon\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[560,-32],"id":"5d6b5368-cfe3-48ae-8fb5-12b840eaf172","name":"AI Agent","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.3,"position":[272,16],"id":"f924f1f6-9283-47aa-9c42-41d1f8cbd068","name":"When chat message received","webhookId":"37e464be-d1a0-4011-abd1-539c54c1dbdd"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.loaixe }}","rightValue":0,"operator":{"type":"number","operation":"notEquals"},"id":"b796e213-5e79-4c03-9399-278e970a9971"}],"combinator":"and"},"renameOutput":true,"outputKey":"phatnguoi"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a8441e0b-ad4c-4581-9279-49eb5e6ed2f4","leftValue":"={{ $json.khuvuc }}","rightValue":"0","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"xoso"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2fa3822e-2570-4db0-9533-32e1175b8648","leftValue":"={{ $json.temdk }}","rightValue":"0","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"dangkiem"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"463ecdcb-9047-410c-a334-4c51d6d4b48b","leftValue":"={{ $json.dateal }}","rightValue":"0","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"amlich"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"932233a1-9d25-4254-ab9c-b50e01bbf295","leftValue":"={{ $json.provinces }}","rightValue":"0","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"tinh"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"36943a34-0589-4292-b864-b709b89203a8","leftValue":"={{ $json.districts }}","rightValue":"0","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"huyen"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[2016,-16],"id":"35a5029a-8077-43b3-8ae7-5893a9a0583b","name":"Switch1"},{"parameters":{"url":"https://dbtt.edu.vn/thoi-tiet-{{ $('Start').item.json.provinces }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7"},{"name":"Accept-Encoding","value":"gzip, deflate, br, zstd"},{"name":"Accept-Language","value":"vi"},{"name":"Cookie","value":"X_CACHE_KEY=28b6f51bbc92a449fbbdc4e1bcf1ef68; __gads=ID=9a22ea042bb6b01a:T=1754016982:RT=1754016982:S=ALNI_ManmXOCWu8b_xpGiYTnKJCPnsfNLw; __gpi=UID=000010ff7c261209:T=1754016982:RT=1754016982:S=ALNI_Ma13CL38s5dHuXGAVEhz-Sq2MtdIA; __eoi=ID=6bdcbd8481cce105:T=1754016982:RT=1754016982:S=AA-AfjY6GDtQfAw00SyLah-XL3ye; cf_clearance=Y_vshcOV4P5AnE8W5ZG1eRZwQfYeNm5mf4LQOn2nde4-1754669244-1.2.1.1-C9gXNtginKlHTJjkb3ViYhru_RUSTt.FVgaRSq.VgfLHESQiDO8QjYTXCAEu8pP7KHy_8IcWsjiwIZAeyURaKkkLW3WjvDfVpKE4fSSn0UEfa6GcqOjfLbuwGfiN0dFCauK94EvpGvKpFpbhotQJMxE.jTvtc4djoindE9ujdS3WmnxA.M7h1pTN6jV3l0pBhKeOpd9lJ244Ujkxt_Zwr9n2ALSHHxM2.bT0nea9mYE"},{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36"},{"name":"Priority","value":"u=0, i"},{"name":"Referer","value":"=https://dbtt.edu.vn/thoi-tiet-{{ $('When Executed by Another Workflow').item.json.provinces }}"},{"name":"Cec-Ch-Ua","value":"\"Not)A;Brand\";v=\"8\", \"Chromium\";v=\"138\", \"Google Chrome\";v=\"138\""},{"name":"Sec-Ch-Ua-Mobile","value":"?0"},{"name":"Sec-Ch-Ua-Platform","value":"\"Windows\""},{"name":"Sec-Fetch-Dest","value":"document"},{"name":"Sec-Fetch-Mode","value":"navigate"},{"name":"Sec-Fetch-Site","value":"same-origin"},{"name":"Sec-Fetch-User","value":"?1"},{"name":"Upgrade-Insecure-Requests","value":"1"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2416,1232],"id":"70ff2494-4eb3-452d-b09b-4015881ff781","name":"HTTP Request"},{"parameters":{"workflowId":{"__rl":true,"value":"XHvQPR1M3x6C8ig8","mode":"list","cachedResultName":"test"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[1552,16],"id":"93451f32-3b46-4042-ae6b-4936c2850ea5","name":"Execute Workflow"},{"parameters":{"description":"=    \"This tool is used to look up the following.\",\n    \"Each tool requires different input fields.\",\n    \"Only the specified fields should be filled; all Other fields fill in 0.\",\n    \"Please reply back with full data.\"\n\n    \"1. Lottery:\",\n    \"- Required fields: khuvuc (region), date (date of draw)\",\n    \"- all Other fields fill in 0 \".\n    \"2. Traffic Violations & violation:\",\n    \"- Required fields: bienso (license plate), loaixe (vehicle type)\",\n    \"- all Other fields fill in 0 \".\n\n    \"3. Vehicle Registration (Inspection):\",\n    \"- Required fields: bienso (license plate), temdk (registration code)\",\n    \"- all Other fields fill in 0 \".\n\n    \"4. Lunar calendar lookup, Good hours, Good/Bad days, travel, taboos\"\n    \"-  If only ask about lunar calendar lookup \",\n    \"-  Required field: datedl\",\n    \"- all Other fields fill in 0 \"\n    \"- If need about Good hours, Good/Bad days, travel, taboos\",\n    \"- Required field: datedl , chitiet \",\n    \"- all Other fields fill in 0 \".\n    \"Your task is to identify which tool to use based on the provided input,\",\n\n    \"5. Weather\"\n    \"-  If only ask about provinces \",\n    \"-  Required field: provinces\",\n    \"- all Other fields fill in 0 \"\n    \"- If need about districts\",\n    \"- Required field: provinces , districts \",\n    \"- all Other fields fill in 0 \".\n    \"Your task is to identify which tool to use based on the provided input,\",","workflowId":{"__rl":true,"value":"bd1HK04dL9S3wEdW","mode":"list","cachedResultName":"My Sub-Workflow 1"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1120,256],"id":"0f1db13e-079b-4e22-9a2e-bd4d710be9ac","name":"test"},{"parameters":{"sseEndpoint":"https://n8n.vhtatn.io.vn/mcp/3612b10e-744d-44ed-8cf7-1d5810318659"},"type":"@n8n/n8n-nodes-langchain.mcpClientTool","typeVersion":1,"position":[736,256],"id":"4562562e-478a-4960-8209-f2d1f1c680cb","name":"test1"},{"parameters":{"path":"3612b10e-744d-44ed-8cf7-1d5810318659"},"type":"@n8n/n8n-nodes-langchain.mcpTrigger","typeVersion":2,"position":[1056,-32],"id":"672d009c-015f-46d9-925a-225a0196ed28","name":"MCP Server Trigger","webhookId":"3612b10e-744d-44ed-8cf7-1d5810318659"}],"connections":{"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Switch1":{"main":[[],[],[],[],[{"node":"HTTP Request","type":"main","index":0}]]},"test":{"ai_tool":[[{"node":"MCP Server Trigger","type":"ai_tool","index":0}]]},"test1":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Execute Workflow":{"main":[[{"node":"Switch1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"0bea94e9-3a06-489b-ba24-e2729fe5a0dd","triggerCount":0,"shared":[{"createdAt":"2025-08-09T01:56:34.130Z","updatedAt":"2025-08-09T01:56:34.130Z","role":"workflow:owner","workflowId":"XHvQPR1M3x6C8ig8","projectId":"Bsx4kBdHQHZGGC5J"}],"tags":[]}