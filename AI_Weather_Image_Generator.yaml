blueprint:
  name: AI Weather Image Generator (Enhanced)
  author: TriTue2011 - Optimized
  description: '# Tá»± Ä‘á»™ng táº¡o áº£nh thá»i tiáº¿t báº±ng AI vá»›i prompt chi tiáº¿t


    âœ¨ TÃ­nh nÄƒng:

    - Tá»± Ä‘á»™ng táº¡o áº£nh khi thá»i tiáº¿t hoáº·c pha thá»i gian thay Ä‘á»•i

    - Há»— trá»£ Ä‘áº§y Ä‘á»§ cáº£m biáº¿n: nhiá»‡t Ä‘á»™, Ä‘á»™ áº©m, giÃ³, cháº¥t lÆ°á»£ng khÃ´ng khÃ­

    - Prompt thÃ´ng minh mÃ´ táº£ chÃ¢n thá»±c thá»i tiáº¿t Viá»‡t Nam

    - TÃ¹y chá»n lÆ°u áº£nh linh hoáº¡t

    '
  domain: automation
  homeassistant:
    min_version: 2024.8.0
  source_url: https://raw.githubusercontent.com/TriTue2011/Blueprint/main/AI_Weather_Image_Generator.yaml
  input:
    weather_sensors:
      name: "\U0001F324ï¸ Cáº£m biáº¿n thá»i tiáº¿t"
      icon: mdi:weather-partly-cloudy
      collapsed: false
      input:
        time_phase_sensor:
          name: Pha thá»i gian trong ngÃ y
          description: Sensor hiá»ƒn thá»‹ buá»•i trong ngÃ y (SÃ¡ng, Chiá»u, Tá»‘i...)
          selector:
            entity:
              filter:
              - domain:
                - sensor
              multiple: false
              reorder: false
        weather_entity:
          name: Thá»±c thá»ƒ thá»i tiáº¿t
          description: Weather entity chÃ­nh (weather.*)
          selector:
            entity:
              filter:
              - domain:
                - weather
              multiple: false
              reorder: false
        temperature_sensor:
          name: Cáº£m biáº¿n nhiá»‡t Ä‘á»™ (tÃ¹y chá»n)
          description: Äá»ƒ trá»‘ng náº¿u khÃ´ng cÃ³
          default: ''
          selector:
            entity:
              filter:
              - domain:
                - sensor
                device_class:
                - temperature
              multiple: false
              reorder: false
        humidity_sensor:
          name: Cáº£m biáº¿n Ä‘á»™ áº©m (tÃ¹y chá»n)
          description: Äá»ƒ trá»‘ng náº¿u khÃ´ng cÃ³
          default: ''
          selector:
            entity:
              filter:
              - domain:
                - sensor
                device_class:
                - humidity
              multiple: false
              reorder: false
        wind_speed_sensor:
          name: Cáº£m biáº¿n tá»‘c Ä‘á»™ giÃ³ (tÃ¹y chá»n)
          default: ''
          selector:
            entity:
              filter:
              - domain:
                - sensor
              multiple: false
              reorder: false
        wind_gust_sensor:
          name: Cáº£m biáº¿n giÃ³ giáº­t (tÃ¹y chá»n)
          default: ''
          selector:
            entity:
              filter:
              - domain:
                - sensor
              multiple: false
              reorder: false
        wind_bearing_sensor:
          name: Cáº£m biáº¿n hÆ°á»›ng giÃ³ (tÃ¹y chá»n)
          default: ''
          selector:
            entity:
              filter:
              - domain:
                - sensor
              multiple: false
              reorder: false
        pressure_sensor:
          name: Cáº£m biáº¿n Ã¡p suáº¥t (tÃ¹y chá»n)
          default: ''
          selector:
            entity:
              filter:
              - domain:
                - sensor
              multiple: false
              reorder: false
    air_quality_sensors:
      name: "\U0001F3ED Cáº£m biáº¿n cháº¥t lÆ°á»£ng khÃ´ng khÃ­"
      icon: mdi:air-filter
      collapsed: true
      input:
        pm25_sensor:
          name: PM2.5 (tÃ¹y chá»n)
          default: ''
          selector:
            entity:
              filter:
              - domain:
                - sensor
              multiple: false
              reorder: false
        pm10_sensor:
          name: PM10 (tÃ¹y chá»n)
          default: ''
          selector:
            entity:
              filter:
              - domain:
                - sensor
              multiple: false
              reorder: false
        carbon_monoxide_sensor:
          name: Carbon Monoxide - CO (tÃ¹y chá»n)
          default: ''
          selector:
            entity:
              filter:
              - domain:
                - sensor
              multiple: false
              reorder: false
        sulfur_dioxide_sensor:
          name: Sulfur Dioxide - SOâ‚‚ (tÃ¹y chá»n)
          default: ''
          selector:
            entity:
              filter:
              - domain:
                - sensor
              multiple: false
              reorder: false
        ozone_sensor:
          name: Ozone - Oâ‚ƒ (tÃ¹y chá»n)
          default: ''
          selector:
            entity:
              filter:
              - domain:
                - sensor
              multiple: false
              reorder: false
        aqi_sensor:
          name: AQI - Chá»‰ sá»‘ cháº¥t lÆ°á»£ng khÃ´ng khÃ­ (tÃ¹y chá»n)
          default: ''
          selector:
            entity:
              filter:
              - domain:
                - sensor
                device_class:
                - aqi
              multiple: false
              reorder: false
    ai_settings:
      name: "\U0001F916 CÃ i Ä‘áº·t AI"
      icon: mdi:robot-outline
      collapsed: false
      input:
        ai_task_entity:
          name: AI Task Entity
          description: Chá»n AI entity Ä‘á»ƒ táº¡o áº£nh
          selector:
            entity:
              filter:
              - domain:
                - ai_task
              multiple: false
              reorder: false
        image_style:
          name: Phong cÃ¡ch áº£nh
          description: Chá»n phong cÃ¡ch áº£nh muá»‘n táº¡o
          default: photorealistic
          selector:
            select:
              options:
              - label: áº¢nh chá»¥p chÃ¢n thá»±c (Photorealistic)
                value: photorealistic
              - label: Phong cÃ¡ch nghá»‡ thuáº­t (Artistic)
                value: artistic
              - label: Phong cÃ¡ch anime/váº½ tay
                value: anime
              - label: Phong cÃ¡ch sá»‘ng Ä‘á»™ng (Vibrant)
                value: vibrant
              multiple: false
              sort: false
              custom_value: false
        image_resolution:
          name: Äá»™ phÃ¢n giáº£i áº£nh
          default: 1024x1024
          selector:
            select:
              options:
              - label: 1024x1024 (VuÃ´ng - Chuáº©n)
                value: 1024x1024
              - label: 1792x1024 (Ngang - Wide)
                value: 1792x1024
              - label: 1024x1792 (Dá»c - Portrait)
                value: 1024x1792
              multiple: false
              sort: false
              custom_value: false
    output_settings:
      name: "\U0001F4BE CÃ i Ä‘áº·t lÆ°u áº£nh"
      icon: mdi:folder-image
      collapsed: true
      input:
        save_image:
          name: LÆ°u áº£nh vÃ o thÆ° má»¥c
          description: Báº­t Ä‘á»ƒ tá»± Ä‘á»™ng lÆ°u áº£nh vÃ o thÆ° má»¥c
          default: true
          selector:
            boolean: {}
        output_directory:
          name: ThÆ° má»¥c Ä‘áº§u ra
          description: ÄÆ°á»ng dáº«n thÆ° má»¥c lÆ°u áº£nh
          default: /media/weather
          selector:
            text:
              multiple: false
              multiline: false
        use_fixed_filename:
          name: Sá»­ dá»¥ng tÃªn file cá»‘ Ä‘á»‹nh
          description: Báº­t Ä‘á»ƒ ghi Ä‘Ã¨ file cÅ©
          default: true
          selector:
            boolean: {}
        fixed_filename:
          name: TÃªn file cá»‘ Ä‘á»‹nh
          description: TÃªn file khi dÃ¹ng cháº¿ Ä‘á»™ cá»‘ Ä‘á»‹nh
          default: weather_current
          selector:
            text:
              multiple: false
              multiline: false
        filename_prefix:
          name: Tiá»n tá»‘ tÃªn file
          description: Tiá»n tá»‘ khi táº¡o file má»›i
          default: weather_
          selector:
            text:
              multiple: false
              multiline: false
        file_extension:
          name: Äá»‹nh dáº¡ng file
          default: png
          selector:
            select:
              options:
              - png
              - jpg
              - jpeg
              - webp
              multiple: false
              sort: false
              custom_value: false
    prompt_settings:
      name: "\U0001F4DD TÃ¹y chá»‰nh Prompt"
      icon: mdi:text-box
      collapsed: true
      input:
        use_custom_prompt:
          name: Sá»­ dá»¥ng prompt tÃ¹y chá»‰nh
          description: Báº­t Ä‘á»ƒ dÃ¹ng prompt cá»§a báº¡n
          default: false
          selector:
            boolean: {}
        custom_prompt:
          name: Prompt tÃ¹y chá»‰nh
          description: Sá»­ dá»¥ng {weather_info} Ä‘á»ƒ chÃ¨n thÃ´ng tin thá»i tiáº¿t
          default: ''
          selector:
            text:
              multiline: true
              type: text
              multiple: false
variables:
  time_phase_sensor: !input time_phase_sensor
  weather_entity: !input weather_entity
  temperature_sensor: !input temperature_sensor
  humidity_sensor: !input humidity_sensor
  wind_speed_sensor: !input wind_speed_sensor
  wind_gust_sensor: !input wind_gust_sensor
  wind_bearing_sensor: !input wind_bearing_sensor
  pressure_sensor: !input pressure_sensor
  pm25_sensor: !input pm25_sensor
  pm10_sensor: !input pm10_sensor
  carbon_monoxide_sensor: !input carbon_monoxide_sensor
  sulfur_dioxide_sensor: !input sulfur_dioxide_sensor
  ozone_sensor: !input ozone_sensor
  aqi_sensor: !input aqi_sensor
  ai_task_entity: !input ai_task_entity
  image_style: !input image_style
  image_resolution: !input image_resolution
  save_image: !input save_image
  output_directory: !input output_directory
  use_fixed_filename: !input use_fixed_filename
  fixed_filename: !input fixed_filename
  filename_prefix: !input filename_prefix
  file_extension: !input file_extension
  use_custom_prompt: !input use_custom_prompt
  custom_prompt: !input custom_prompt
triggers:
- trigger: state
  entity_id: !input weather_entity
  id: weather_change
- trigger: state
  entity_id: !input time_phase_sensor
  id: time_phase_change
conditions: []
actions:
- variables:
    time_phase: '{{ states(time_phase_sensor) if time_phase_sensor and states(time_phase_sensor) not in [''unknown'', ''unavailable'', ''none'', ''''] else '''' }}'
    weather_state: '{{ states(weather_entity) if weather_entity and states(weather_entity) not in [''unknown'', ''unavailable'', ''none'', ''''] else '''' }}'
    temperature: '{{ states(temperature_sensor) if temperature_sensor and states(temperature_sensor) not in [''unknown'', ''unavailable'', ''none'', ''''] else '''' }}'
    humidity: '{{ states(humidity_sensor) if humidity_sensor and states(humidity_sensor) not in [''unknown'', ''unavailable'', ''none'', ''''] else '''' }}'
    wind_speed: '{{ states(wind_speed_sensor) if wind_speed_sensor and states(wind_speed_sensor) not in [''unknown'', ''unavailable'', ''none'', ''''] else '''' }}'
    wind_gust: '{{ states(wind_gust_sensor) if wind_gust_sensor and states(wind_gust_sensor) not in [''unknown'', ''unavailable'', ''none'', ''''] else '''' }}'
    wind_bearing: '{{ states(wind_bearing_sensor) if wind_bearing_sensor and states(wind_bearing_sensor) not in [''unknown'', ''unavailable'', ''none'', ''''] else '''' }}'
    pressure: '{{ states(pressure_sensor) if pressure_sensor and states(pressure_sensor) not in [''unknown'', ''unavailable'', ''none'', ''''] else '''' }}'
    pm25: '{{ states(pm25_sensor) if pm25_sensor and states(pm25_sensor) not in [''unknown'', ''unavailable'', ''none'', ''''] else '''' }}'
    pm10: '{{ states(pm10_sensor) if pm10_sensor and states(pm10_sensor) not in [''unknown'', ''unavailable'', ''none'', ''''] else '''' }}'
    carbon_monoxide: '{{ states(carbon_monoxide_sensor) if carbon_monoxide_sensor and states(carbon_monoxide_sensor) not in [''unknown'', ''unavailable'', ''none'', ''''] else '''' }}'
    sulfur_dioxide: '{{ states(sulfur_dioxide_sensor) if sulfur_dioxide_sensor and states(sulfur_dioxide_sensor) not in [''unknown'', ''unavailable'', ''none'', ''''] else '''' }}'
    ozone: '{{ states(ozone_sensor) if ozone_sensor and states(ozone_sensor) not in [''unknown'', ''unavailable'', ''none'', ''''] else '''' }}'
    aqi: '{{ states(aqi_sensor) if aqi_sensor and states(aqi_sensor) not in [''unknown'', ''unavailable'', ''none'', ''''] else '''' }}'
    is_night: '{{ time_phase in [''ÄÃªm'', ''Tá»‘i''] }}'
- variables:
    weather_info: "{% set parts = [] %}\n{% if time_phase %}\n  {% set parts = parts + ['Thá»i gian: ' ~ time_phase] %}\n{% endif %}\n{% if weather_state %}\n  {% set parts = parts + ['Thá»i tiáº¿t: ' ~ weather_state] %}\n{% endif %}\n{% if temperature %}\n  {% set parts = parts + ['Nhiá»‡t Ä‘á»™: ' ~ temperature ~ 'Â°C'] %}\n{% endif %}\n{% if humidity %}\n  {% set parts = parts + ['Äá»™ áº©m: ' ~ humidity ~ '%'] %}\n{% endif %}\n{% if wind_speed %}\n  {% set parts = parts + ['Tá»‘c Ä‘á»™ giÃ³: ' ~ wind_speed ~ ' km/h'] %}\n{% endif %}\n{% if wind_gust %}\n  {% set parts = parts + ['GiÃ³ giáº­t: ' ~ wind_gust ~ ' km/h'] %}\n{% endif %}\n{% if wind_bearing %}\n  {% if wind_bearing is number or wind_bearing | regex_match('^[0-9.]+$') %}\n    {% set bearing = wind_bearing | float %}\n    {% if bearing >= 337.5 or bearing < 22.5 %}\n      {% set direction = 'Báº¯c' %}\n    {% elif bearing >= 22.5 and bearing < 67.5 %}\n      {% set direction = 'ÄÃ´ng Báº¯c' %}\n    {% elif bearing >= 67.5 and bearing < 112.5 %}\n      {% set direction = 'ÄÃ´ng' %}\n    {% elif bearing >= 112.5 and bearing < 157.5 %}\n      {% set direction = 'ÄÃ´ng Nam' %}\n    {% elif bearing >= 157.5 and bearing < 202.5 %}\n      {% set direction = 'Nam' %}\n    {% elif bearing >= 202.5 and bearing < 247.5 %}\n      {% set direction = 'TÃ¢y Nam' %}\n    {% elif bearing >= 247.5 and bearing < 292.5 %}\n      {% set direction = 'TÃ¢y' %}\n    {% else %}\n      {% set direction = 'TÃ¢y Báº¯c' %}\n    {% endif %}\n    {% set parts = parts + ['HÆ°á»›ng giÃ³: ' ~ direction ~ ' (' ~ bearing ~ 'Â°)'] %}\n  {% else %}\n    {% set parts = parts + ['HÆ°á»›ng giÃ³: ' ~ wind_bearing] %}\n  {% endif %}\n{% endif %}\n{% if aqi %}\n  {% set aqi_val = aqi | float %}\n  {% if aqi_val <= 50 %}\n    {% set aqi_text = 'Tá»‘t' %}\n  {% elif aqi_val <= 100 %}\n    {% set aqi_text = 'Trung bÃ¬nh' %}\n  {% elif aqi_val <= 150 %}\n    {% set aqi_text = 'KÃ©m' %}\n  {% elif aqi_val <= 200 %}\n    {% set aqi_text = 'Xáº¥u' %}\n  {% elif aqi_val <= 300 %}\n    {% set aqi_text = 'Ráº¥t xáº¥u' %}\n  {% else %}\n    {% set aqi_text = 'Nguy háº¡i' %}\n  {% endif %}\n  {% set parts = parts + ['Cháº¥t lÆ°á»£ng khÃ´ng khÃ­: ' ~ aqi_text ~ ' (AQI: ' ~ aqi ~ ')'] %}\n{% endif %}\n{% if pm25 %}\n  {% set parts = parts + ['PM2.5: ' ~ pm25 ~ ' Âµg/mÂ³'] %}\n{% endif %}\n{% if pm10 %}\n  {% set parts = parts + ['PM10: ' ~ pm10 ~ ' Âµg/mÂ³'] %}\n{% endif %}\n{% if carbon_monoxide %}\n  {% set parts = parts + ['CO: ' ~ carbon_monoxide ~ ' ppm'] %}\n{% endif %}\n{% if sulfur_dioxide %}\n  {% set parts = parts + ['SOâ‚‚: ' ~ sulfur_dioxide ~ ' ppb'] %}\n{% endif %}\n{% if ozone %}\n  {% set parts = parts + ['Oâ‚ƒ: ' ~ ozone ~ ' ppb'] %}\n{% endif %}\n{{ parts | join(', ') }}"
- variables:
    default_prompt: "Dá»® LIá»†U THá»œI TIáº¾T HIá»†N Táº I:\n{weather_info}\n\nYÃŠU Cáº¦U Táº O áº¢NH:\nTáº¡o má»™t bá»©c áº£nh phong cáº£nh lÃ ng quÃª Viá»‡t Nam vá»›i Ä‘á»™ chÃ¢n thá»±c cao (photorealistic), pháº£n Ã¡nh chÃ­nh xÃ¡c cÃ¡c Ä‘iá»u kiá»‡n thá»i tiáº¿t vÃ  thá»i gian trong ngÃ y dá»±a trÃªn dá»¯ liá»‡u trÃªn.\n\nğŸ“ THÃ”NG Sá» Ká»¸ THUáº¬T:\n- PANORAMIC COMPOSITION: Wide angle camera view\n- ASPECT RATIO: 16:9 (NOT square, NOT 1:1)\n- RESOLUTION: 3840 Ã— 2160 pixels\n- FORMAT: Landscape orientation, cinematic framing\n- CAMERA: Wide-angle lens (24-35mm equivalent), eye-level perspective\n\nCHI TIáº¾T Cá»¤ THá»‚:\n\nğŸŒ… ÃNH SÃNG & THá»œI GIAN:\n- Dá»±a vÃ o thá»i gian trong ngÃ y Ä‘á»ƒ táº¡o Ã¡nh sÃ¡ng phÃ¹ há»£p:\n  + Ráº¡ng sÃ¡ng/BÃ¬nh minh: Ãnh sÃ¡ng vÃ ng cam nháº¡t, báº§u trá»i chuyá»ƒn mÃ u, sÆ°Æ¡ng mÃ¹ nháº¹\n  + Buá»•i sÃ¡ng: Ãnh sÃ¡ng tráº¯ng vÃ ng tÆ°Æ¡i sÃ¡ng, bÃ³ng dÃ i, khÃ´ng khÃ­ trong lÃ nh\n  + Buá»•i trÆ°a: Ãnh sÃ¡ng chÃ³i chang, bÃ³ng ngáº¯n, nhiá»‡t Ä‘á»™ cao\n  + Buá»•i chiá»u: Ãnh sÃ¡ng vÃ ng áº¥m, bÃ³ng dÃ i, khÃ´ng khÃ­ dá»‹u hÆ¡n\n  + HoÃ ng hÃ´n: Ãnh sÃ¡ng vÃ ng Ä‘á», báº§u trá»i gradient Ä‘áº¹p, bÃ³ng ráº¥t dÃ i\n  + Buá»•i tá»‘i: Báº§u trá»i chuyá»ƒn mÃ u tÃ­m xanh, Ã¡nh Ä‘Ã¨n nhÃ  báº¯t Ä‘áº§u sÃ¡ng, hoÃ ng hÃ´n tÃ n\n  + ÄÃªm: Báº§u trá»i Ä‘en/xanh Ä‘áº­m, trÄƒng sao, Ã¡nh Ä‘Ã¨n nhÃ  cá»­a vÃ ng áº¥m, Ä‘Æ°á»ng lÃ ng tá»‘i\n- Pháº£n chiáº¿u Ã¡nh sÃ¡ng trÃªn nÆ°á»›c, lÃ¡ cÃ¢y, máº·t Ä‘áº¥t pháº£i chÃ­nh xÃ¡c\n- Äá»™ tÆ°Æ¡ng pháº£n vÃ  mÃ u sáº¯c phÃ¹ há»£p vá»›i giá» trong ngÃ y\n\nâ˜ï¸ THá»œI TIáº¾T & KHÃ QUYá»‚N:\n- MÃ´ táº£ chÃ­nh xÃ¡c Ä‘iá»u kiá»‡n thá»i tiáº¿t (náº¯ng, mÆ°a, mÃ¢y, sÆ°Æ¡ng mÃ¹...)\n- Náº¿u cÃ³ mÆ°a: ThÃªm vÅ©ng nÆ°á»›c, bÃ¹n, Ã¡o mÆ°a Ä‘á»ƒ trÆ°á»›c nhÃ , giá»t mÆ°a rÃµ rÃ ng\n- Náº¿u cÃ³ giÃ³: CÃ¢y cá»‘i nghiÃªng, quáº§n Ã¡o phÆ¡i tung bay (náº¿u ban ngÃ y), gá»£n sÃ³ng trÃªn nÆ°á»›c\n- Náº¿u nhiá»‡t Ä‘á»™ cao: KhÃ´ng khÃ­ nÃ³ng bá»©c, hiá»‡u á»©ng heat haze, bá»¥i Ä‘Æ°á»ng\n- Náº¿u nhiá»‡t Ä‘á»™ tháº¥p: KhÃ³i tá»« báº¿p lá»­a, sÆ°Æ¡ng mÃ¹, khÃ´ng khÃ­ láº¡nh\n- Äá»™ áº©m cao: KhÃ´ng khÃ­ áº©m, giá»t sÆ°Æ¡ng, cáº£m giÃ¡c náº·ng ná»\n\nğŸŒ¾ Cáº¢NH Váº¬T & MÃ”I TRÆ¯á»œNG:\n- Ruá»™ng lÃºa: Xanh mÆ¡n má»Ÿn (mÃ¹a máº¡), vÃ ng Ã³ng (mÃ¹a gáº·t), hoáº·c khÃ´ rÃ¡o (mÃ¹a khÃ´)\n- Ao há»“: Pháº£n chiáº¿u báº§u trá»i, cÃ³ vá»‹t bÆ¡i (ban ngÃ y), thuyá»n nan, cÃ¢y tre bÃªn bá»\n- ÄÆ°á»ng lÃ ng: Äáº¥t Ä‘á» hoáº·c xi mÄƒng, cÃ³ váº¿t bÃ¡nh xe, vÅ©ng nÆ°á»›c náº¿u mÆ°a\n- NhÃ  cá»­a: Kiá»ƒu nhÃ  cáº¥p 4, mÃ¡i ngÃ³i Ä‘á», tÆ°á»ng vÃ´i vÃ ng, chuá»“ng gÃ , vÆ°á»n rau\n  + Ban Ä‘Ãªm: Cá»­a sá»• sÃ¡ng Ä‘Ã¨n vÃ ng áº¥m, má»™t vÃ i ngÃ´i nhÃ  tá»‘i, khÃ³i báº¿p tá»« á»‘ng khÃ³i\n- CÃ¢y cá»‘i: CÃ¢y dá»«a, chuá»‘i, tre, ná»©a, cÃ¢y Äƒn quáº£ (xoÃ i, nhÃ£n, váº£i)\n\nğŸ‘¥ CON NGÆ¯á»œI & SINH HOáº T:\n{% if is_night %}\nğŸŒ™ Äáº¶C BIá»†T CHO Cáº¢NH ÄÃŠM:\n- ABSOLUTELY NO PEOPLE visible in the scene\n- NO farmers, children, elderly, or any human figures\n- NO human activities or movements\n- ONLY empty landscapes with:\n  + Warm yellow lights from house windows\n  + Silhouettes of houses and trees against night sky\n  + Peaceful, quiet, deserted village atmosphere\n  + Sleeping animals (chickens in coops, buffalo resting)\n  + Moonlight reflecting on water if present\n  + Stars or moon in the sky\n  + Smoke from chimneys (sign of indoor activity, but no people visible)\n  + Clothes hanging still on clotheslines\n  + Empty paths and roads\n  + Occasional warm glow from windows suggesting life inside, but exterior is empty\n- The scene must convey tranquility, stillness, and the absence of outdoor human activity\n{% else %}\n- Hoáº¡t Ä‘á»™ng phÃ¹ há»£p thá»i gian: LÃ m ruá»™ng buá»•i sÃ¡ng, nghá»‰ trÆ°a, chÄƒn trÃ¢u chiá»u\n- Trang phá»¥c: Ão ba ba, nÃ³n lÃ¡, Ã¡o mÆ°a khi mÆ°a, Ã¡o dÃ y khi láº¡nh\n- NgÆ°á»i nÃ´ng dÃ¢n Ä‘ang lÃ m viá»‡c: Cáº¥y lÃºa, gáº·t lÃºa, tÃ¡t nÆ°á»›c, chÄƒn trÃ¢u\n- Tráº» em chÆ¡i Ä‘Ã¹a: Táº¯m ao, tháº£ diá»u, chÆ¡i bi, báº¯t chuá»“n chuá»“n\n- NgÆ°á»i giÃ : Ngá»“i uá»‘ng trÃ , nÃ³i chuyá»‡n, phÆ¡i náº¯ng\n- Sá»‘ lÆ°á»£ng: 2-5 ngÆ°á»i trong cáº£nh, khÃ´ng quÃ¡ Ä‘Ã´ng\n{% endif %}\n\nğŸ„ Äá»˜NG Váº¬T:\n{% if is_night %}\n- TrÃ¢u bÃ² Ä‘ang náº±m nghá»‰ hoáº·c ngá»§\n- GÃ  vá»‹t trong chuá»“ng (khÃ´ng tháº¥y rÃµ, chá»‰ tháº¥y chuá»“ng)\n- ChÃ³ náº±m ngá»§ trÆ°á»›c hiÃªn nhÃ \n- KhÃ´ng cÃ³ Ä‘á»™ng váº­t hoáº¡t Ä‘á»™ng máº¡nh\n{% else %}\n- TrÃ¢u bÃ² tháº£ á»Ÿ ruá»™ng hoáº·c bá» ao\n- GÃ  vá»‹t cháº¡y nháº£y quanh sÃ¢n\n- Chim bay trÃªn trá»i hoáº·c Ä‘áº­u trÃªn cÃ nh\n- ChÃ³ mÃ¨o náº±m ngá»§ hoáº·c Ä‘i láº¡i\n{% endif %}\n\nğŸ­ CHáº¤T LÆ¯á»¢NG KHÃ”NG KHÃ:\n- Náº¿u AQI tá»‘t (<50): KhÃ´ng khÃ­ trong lÃ nh, táº§m nhÃ¬n xa, mÃ u sáº¯c tÆ°Æ¡i sÃ¡ng, sao sÃ¡ng (Ä‘Ãªm)\n- Náº¿u AQI trung bÃ¬nh (50-100): HÆ¡i má» nháº¹, mÃ u sáº¯c bÃ¬nh thÆ°á»ng\n- Náº¿u AQI kÃ©m (100-150): SÆ°Æ¡ng mÃ¹ nháº¹, táº§m nhÃ¬n giáº£m, mÃ u sáº¯c xÃ¡m hÆ¡n\n- Náº¿u AQI xáº¥u (>150): SÆ°Æ¡ng mÃ¹ Ä‘áº­m, khÃ³i bá»¥i rÃµ, cÃ³ thá»ƒ tháº¥y nhÃ  mÃ¡y xa xa, khÃ´ng tháº¥y sao (Ä‘Ãªm)\n\nğŸ¨ Ká»¸ THUáº¬T NHIáº¾P áº¢NH:\n- Phong cÃ¡ch: Photorealistic, nhÆ° áº£nh chá»¥p báº±ng mÃ¡y DSLR chuyÃªn nghiá»‡p\n- GÃ³c chá»¥p: Wide-angle panoramic, ngang 16:9, bao quÃ¡t toÃ n cáº£nh\n- Äá»™ phÃ¢n giáº£i: Cao, chi tiáº¿t sáº¯c nÃ©t, 3840Ã—2160 pixels\n- Depth of field: LÃ m má» ná»n Ä‘á»ƒ táº¡o chiá»u sÃ¢u\n- Motion blur: Má» chuyá»ƒn Ä‘á»™ng khi cÃ³ giÃ³ máº¡nh hoáº·c mÆ°a (náº¿u ban ngÃ y)\n- Composition: Quy táº¯c tam phÃ¢n, cÃ¢n báº±ng, dáº«n máº¯t ngÆ°á»i xem, táº­n dá»¥ng khÃ´ng gian ngang\n- Texture: Chi tiáº¿t bá» máº·t rÃµ rÃ ng (lÃ¡ cÃ¢y, Ä‘áº¥t, nÆ°á»›c, gá»—, váº£i)\n- Lighting: ChÃ­nh xÃ¡c vá» phÆ°Æ¡ng hÆ°á»›ng, cÆ°á»ng Ä‘á»™, mÃ u sáº¯c\n  + ÄÃªm: ChÃº trá»ng contrast giá»¯a Ã¡nh Ä‘Ã¨n vÃ ng áº¥m vÃ  báº§u trá»i tá»‘i\n- Color grading: Tá»± nhiÃªn, khÃ´ng quÃ¡ bÃ£o hÃ²a, phÃ¹ há»£p thá»i gian\n  + ÄÃªm: TÃ´ng mÃ u xanh Ä‘áº­m/Ä‘en cho báº§u trá»i, vÃ ng áº¥m cho Ã¡nh Ä‘Ã¨n\n\nğŸš« LÆ¯U Ã TRÃNH:\n- STRICTLY NO text, letters, words, signatures, logos, watermarks, or any written characters anywhere in the image\n- ABSOLUTELY NO branding, company names, or identification marks of any kind\n- KHÃ”NG cÃ³ yáº¿u tá»‘ hiá»‡n Ä‘áº¡i (Ã´ tÃ´, Ä‘iá»‡n thoáº¡i, quáº£ng cÃ¡o, biá»ƒn hiá»‡u)\n- KHÃ”NG cÃ³ chi tiáº¿t phi thá»±c táº¿ hoáº·c ká»³ áº£o\n- KHÃ”NG lÃ m má» hoáº·c pixel hÃ³a\n- KHÃ”NG cÃ³ lá»—i giáº£i pháº«u (ngÆ°á»i, Ä‘á»™ng váº­t)\n- KHÃ”NG cÃ³ tá»· lá»‡ khung hÃ¬nh vuÃ´ng (1:1) - báº¯t buá»™c pháº£i 16:9\n- The image must be completely clean without any overlay text or graphics\n{% if is_night %}\n- CRITICAL: NO PEOPLE AT ALL during night scenes - this is mandatory\n{% endif %}\n\nğŸ¯ Má»¤C TIÃŠU CUá»I CÃ™NG:\nTáº¡o má»™t bá»©c áº£nh panoramic 16:9 mÃ  ngÆ°á»i xem cÃ³ thá»ƒ \"cáº£m nháº­n\" Ä‘Æ°á»£c thá»i tiáº¿t, thá»i gian, vÃ  khÃ´ng khÃ­ cá»§a lÃ ng quÃª Viá»‡t Nam qua tá»«ng chi tiáº¿t nhá». {% if is_night %}Cáº£nh Ä‘Ãªm pháº£i hoÃ n toÃ n váº¯ng ngÆ°á»i, chá»‰ cÃ³ Ã¡nh Ä‘Ã¨n vÃ  bÃ³ng Ä‘Ãªm, táº¡o cáº£m giÃ¡c yÃªn bÃ¬nh vÃ  tÄ©nh láº·ng.{% else %}áº¢nh pháº£i chÃ¢n thá»±c Ä‘áº¿n má»©c nhÆ° thá»ƒ Ä‘Æ°á»£c chá»¥p bá»Ÿi má»™t nhiáº¿p áº£nh gia chuyÃªn nghiá»‡p Ä‘ang Ä‘á»©ng táº¡i hiá»‡n trÆ°á»ng.{% endif %}\n"
    final_prompt: "{% if use_custom_prompt and custom_prompt %}\n  {{ custom_prompt | replace('{weather_info}', weather_info) }}\n{% else %}\n  {{ default_prompt | replace('{weather_info}', weather_info) }}\n{% endif %}"
    task_name: Weather - {{ time_phase if time_phase else 'Unknown' }} - {{ weather_state if weather_state else 'Unknown' }}
- action: ai_task.generate_image
  data:
    entity_id: '{{ ai_task_entity }}'
    task_name: '{{ task_name }}'
    instructions: '{{ final_prompt }}'
  response_variable: ai_result
- if:
  - condition: template
    value_template: '{{ ai_result is defined and ai_result.media_source_id is defined
      }}'
  then:
  - variables:
      source_id: '{{ ai_result.media_source_id }}'
      image_path: "{% if source_id.startswith('media-source://ai_task/image/') %}\n
        \ /media/ai_task/image/{{ source_id.split('/')[-1] }}\n{% elif source_id.startswith('media-source://')
        %}\n  /media/{{ source_id.replace('media-source://', '').replace('//', '/')
        }}\n{% else %}\n  {{ source_id }}\n{% endif %}"
  - if:
    - condition: template
      value_template: '{{ save_image }}'
    then:
    - variables:
        timestamp: '{{ now().strftime(''%Y%m%d_%H%M%S'') }}'
        filename: "{% if use_fixed_filename %}\n  {{ fixed_filename }}.{{ file_extension
          }}\n{% else %}\n  {{ filename_prefix }}{{ timestamp }}.{{ file_extension
          }}\n{% endif %}"
        dest_path: '{{ output_directory }}/{{ filename }}'
    - action: shell_command.copy_weather_image
      data:
        source: '{{ image_path }}'
        destination: '{{ dest_path }}'
mode: single
max_exceeded: silent
