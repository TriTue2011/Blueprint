{"createdAt":"2025-08-25T16:44:29.202Z","updatedAt":"2025-08-26T04:11:26.143Z","id":"C4LlOyeO1AXflv4i","name":"l·ªãch v·∫°n ni√™n","active":false,"isArchived":false,"nodes":[{"parameters":{"workflowInputs":{"values":[{"name":"chitiet","type":"any"},{"name":"type","type":"any"},{"name":"date","type":"any"}]}},"id":"933dcd5a-9b03-427e-be32-c69cf46b8312","typeVersion":1.1,"name":"Start","type":"n8n-nodes-base.executeWorkflowTrigger","position":[816,1856]},{"parameters":{"url":"=https://lichngaytot.com/Ajax/DoiNgayAmDuongAjax?Date={{ $json.date.split('-')[0] }}&Month={{ $json.date.split('-')[1] }}&Year={{ $json.date.split('-')[2] }}&Type={{ $('Start').item.json.type }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1248,1856],"id":"9050ac8e-4faf-4f6a-9941-8b41275c6118","name":"vannien"},{"parameters":{"jsCode":"function decodeHtmlEntities(str) {\n  if (!str) return '';\n  // Gi·∫£i m√£ s·ªë th·∫≠p ph√¢n tr∆∞·ªõc r·ªìi m·ªõi ƒë·∫øn th·∫≠p l·ª•c ph√¢n\n  str = str.replace(/&#(\\d+);/g, (_, code) => String.fromCharCode(parseInt(code, 10)));\n  str = str.replace(/&#x([0-9a-fA-F]+);/g, (_, code) => String.fromCharCode(parseInt(code, 16)));\n  const map = { '&nbsp;': ' ', '&amp;': '&', '&lt;': '<', '&gt;': '>', '&quot;': '\"', '&apos;': \"'\" };\n  return str.replace(/&[a-zA-Z]+;/g, m => map[m] || m);\n}\n\nfunction stripTags(str) {\n  return decodeHtmlEntities(String(str || '')\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<[^>]+>/g, '')) // s·ª≠a [^>]* th√†nh [^>]+ ƒë·ªÉ kh√¥ng match qu√° r·ªông\n    .replace(/\\u00A0/g, ' ')\n    .trim();\n}\n\nfunction firstTable1(html) {\n  const m = html.match(/<table[^>]*class=\"[^\"]*\\btable1\\b[^\"]*\"[^>]*>[\\s\\S]*?<\\/table>/i);\n  return m ? m[0] : '';\n}\n\nfunction textAfter(label, htmlScope) {\n  if (!htmlScope) return '';\n  // Kh√¥ng d√πng \\s* trong </td> ƒë·ªÉ tr√°nh match sai, d√πng \\s* trong <td[^>]*> v·∫´n ·ªïn\n  const re = new RegExp(\n    `<tr>\\\\s*<td[^>]*>\\\\s*${label}\\\\s*<\\\\/td>\\\\s*<td[^>]*>([\\\\s\\\\S]*?)<\\\\/td>\\\\s*<\\\\/tr>`,\n    'i'\n  );\n  const m = htmlScope.match(re);\n  return m ? stripTags(m[1]) : '';\n}\n\nfunction extractTableByTitle(html, titleRegex) {\n  if (!html) return '';\n  // T√¨m ti√™u ƒë·ªÅ (h2 ho·∫∑c h3) theo titleRegex\n  const titleRe = new RegExp(`<h[23][^>]*>\\\\s*${titleRegex.source}\\\\s*<\\\\/h[23]>`, 'i');\n  const titleMatch = html.match(titleRe);\n  if (!titleMatch) return '';\n  const startIndex = titleMatch.index + titleMatch[0].length;\n  const subHtml = html.slice(startIndex);\n  const tblMatch = subHtml.match(/<table[^>]*class=\"[^\"]*\\btable1\\b[^\"]*\"[^>]*>[\\s\\S]*?<\\/table>/i);\n  return tblMatch ? tblMatch[0] : '';\n}\n\nfunction extractRows3cols(tableHtml) {\n  if (!tableHtml) return [];\n  const rows = [];\n  const trRe = /<tr>([\\s\\S]*?)<\\/tr>/gi;\n  let m;\n  while ((m = trRe.exec(tableHtml))) {\n    const tds = Array.from(m[1].matchAll(/<td[^>]*>([\\s\\S]*?)<\\/td>/gi)).map(x => stripTags(x[1]));\n    if (tds.length === 3) rows.push({ c1: tds[0], c2: tds[1], c3: tds[2] });\n  }\n  return rows;\n}\n\nfunction extractSectionByH3Title(html, blockTitle) {\n  if (!html) return '';\n  const re = new RegExp(\n    `<table[^>]*class=\"[^\"]*table1[^\"]*\"[^>]*>[\\\\s\\\\S]*?<h3[^>]*>\\\\s*${blockTitle}\\\\s*<\\\\/h3>[\\\\s\\\\S]*?<\\\\/table>`,\n    'i'\n  );\n  const m = html.match(re);\n  return m ? m[0] : '';\n}\n\nfunction extractGioBlock(html, blockTitle) {\n  const tbl = extractSectionByH3Title(html, blockTitle);\n  const rows = extractRows3cols(tbl);\n  return rows.map(r => ({ time: r.c1, diaChi: r.c2, sao: r.c3 }));\n}\n\nfunction extractTuoiXungKhac(html) {\n  const sec = extractTableByTitle(html, /Tu·ªïi xung kh·∫Øc/i);\n  if (!sec) return { xungNgay: [], xungThang: [] };\n  const body = stripTags(sec);\n  const xungNgay = (body.match(/Xung ng√†y:\\s*([^\\n]+)/i)?.[1] || '').split(/,\\s*/).filter(Boolean);\n  const xungThang = (body.match(/Xung th√°ng:\\s*([^\\n]+)/i)?.[1] || '').split(/,\\s*/).filter(Boolean);\n  return { xungNgay, xungThang };\n}\n\nfunction extractNgocHap(html) {\n  const goodTbl = extractTableByTitle(html, /Ng√†y t·ªët x·∫•u theo ng·ªçc h·∫°p th√¥ng th∆∞[\\s\\S]*?Sao t·ªët/i);\n  const good = [];\n  if (goodTbl) {\n    const trRe = /<tr>\\s*<td[^>]*>([\\s\\S]*?)<\\/td>\\s*<td[^>]*>([\\s\\S]*?)<\\/td>\\s*<\\/tr>/gi;\n    let m;\n    while ((m = trRe.exec(goodTbl))) {\n      const left = stripTags(m[1]);\n      const right = stripTags(m[2]);\n      if (/Sao t·ªët|Vi·ªác n√™n l√†m/i.test(left)) continue;\n      if (left && right) good.push({ sao: left, note: right });\n    }\n  }\n  const badTbl = extractTableByTitle(html, /Sao x·∫•u/i);\n  const bad = [];\n  if (badTbl) {\n    const trRe2 = /<tr>\\s*<td[^>]*>([\\s\\S]*?)<\\/td>\\s*<td[^>]*>([\\s\\S]*?)<\\/td>\\s*<\\/tr>/gi;\n    let m2;\n    while ((m2 = trRe2.exec(badTbl))) {\n      const left = stripTags(m2[1]);\n      const right = stripTags(m2[2]);\n      if (/Sao x·∫•u|Vi·ªác n√™n k·ªµ/i.test(left)) continue;\n      if (left && right) bad.push({ sao: left, note: right });\n    }\n  }\n  return { good, bad };\n}\n\nfunction extractXuatHanh(html) {\n  const tbl = extractTableByTitle(html, /Ng√†y, gi·ªù, h∆∞·ªõng xu·∫•t h√†nh/i);\n  if (!tbl) return { hy: '', tai: '' };\n  const text = stripTags(tbl);\n  const hy = (text.match(/H·ª∑ th·∫ßn[^:]*:\\s*H∆∞·ªõng\\s*([^\\n]+)/i)?.[1] || '').trim();\n  const tai = (text.match(/T√†i th·∫ßn[^:]*:\\s*H∆∞·ªõng\\s*([^\\n]+)/i)?.[1] || '').trim();\n  return { hy, tai };\n}\n\nfunction extractKhongMinh(html) {\n  const tbl = extractTableByTitle(html, /Ng√†y xu·∫•t h√†nh[^<]*theo Kh·ªïng Minh/i);\n  if (!tbl) return { ten: '', danhGia: '', moTa: '' };\n  const body = stripTags(tbl);\n  const m = body.match(/([^\\n]+?)\\s*\\((T·ªêT|T·ªët|X·∫§U|X·∫•u)\\)\\s*([^\\n]+)/i);\n  if (m) return { ten: m[1].trim(), danhGia: m[2].toUpperCase(), moTa: m[3].trim() };\n  return { ten: '', danhGia: '', moTa: '' };\n}\n\nfunction extractLyThuanPhong(html) {\n  const all = [];\n  const secRe = /<div class=\"nam-xua-item-1s\">([\\s\\S]*?)<\\/div>\\s*<\\/div>/gi;\n  let m;\n  while ((m = secRe.exec(html))) {\n    const block = m[1];\n    const leftRaw = block.match(/<div[^>]*left-nam-xua[^>]*>[\\s\\S]*?<span[^>]*>([\\s\\S]*?)<\\/span>/i)?.[1] || '';\n    const right = block.match(/<div[^>]*right-nam-xua[^>]*>[\\s\\S]*?<\\/div>/i)?.[0] || '';\n    const times = stripTags(leftRaw).split(/\\s*\\n\\s*/).map(s => s.trim()).filter(Boolean);\n    const nhan = (right.match(/>\\s*([^:<]+):\\s*<span/i)?.[1] || '').trim();\n    const danhGia = (right.match(/(T·ªêT|X·∫§U)/i)?.[1] || '').toUpperCase();\n    all.push({ nhan, danhGia, times });\n  }\n  const tot = [];\n  const xau = [];\n  for (const it of all) {\n    if (it.danhGia === 'T·ªêT') tot.push(`${it.nhan} (${it.times.join(', ')})`);\n    else if (it.danhGia === 'X·∫§U') xau.push(`${it.nhan} (${it.times.join(', ')})`);\n  }\n  return { tot, xau };\n}\n\nfunction extractNguHanhTrachNhat(html) {\n  const tbl = extractTableByTitle(html, /Ng≈© h√†nh[^<]*\\(tr·∫°ch nh·∫≠t\\)/i);\n  if (!tbl) return { nienMenh: '', ngayCat: '', kyTuoi: [], hopXungLine: '', tamSat: '' };\n  const body = stripTags(tbl);\n  const nienMenh = (body.match(/Ng≈© h√†nh ni√™n m·ªánh:\\s*([^\\n]+)/i)?.[1] || '').trim();\n  const ngayCat = body.match(/ng√†y c√°t|\\(b·∫£o nh·∫≠t\\)/i) ? 'Ng√†y c√°t (b·∫£o nh·∫≠t)' : '';\n  const kyTuoiLine = (body.match(/k·ªã tu·ªïi:\\s*([^\\n]+)/i)?.[1] || '').trim();\n  const kyTuoi = kyTuoiLine ? kyTuoiLine.split(/,\\s*/).filter(Boolean) : [];\n  const hopXungLine = (body.match(/H·ª£p & xung:\\s*([^\\n]+)/i)?.[1] || '').trim();\n  const tamSat = (body.match(/Tam S√°t k·ªã m·ªánh tu·ªïi\\s*:\\s*([^\\n]+)/i)?.[1] || '').trim();\n  return { nienMenh, ngayCat, kyTuoi, hopXungLine, tamSat };\n}\n\n// ---------- B·∫ÆT ƒê·∫¶U ----------\n// Function node d√πng \"items\"\nconst html = String(items?.[0]?.json?.data || '');\n\n// L·∫•y b·∫£ng ƒë·∫ßu (th√¥ng tin ng√†y th√°ng‚Ä¶)\nconst infoTable = firstTable1(html);\n\n// C√°c tr∆∞·ªùng trong b·∫£ng ƒë·∫ßu\nconst duongLich = textAfter('D∆∞∆°ng l·ªãch', infoTable);\nconst amLich = textAfter('√Çm l·ªãch', infoTable).replace(/\\s+/g, ' ').trim();\nconst canChi = textAfter('Can chi', infoTable);\nconst nguHanh = textAfter('Ng≈© h√†nh', infoTable);\nconst loaiNgay = textAfter('Ng√†y', infoTable);\nconst tietKhi = stripTags(\n  (infoTable.match(/Ti·∫øt Kh√≠[\\s\\S]*?<td[^>]*>([\\s\\S]*?)<\\/td>/i)?.[1]) || ''\n);\n\n// Gi·ªù ho√†ng ƒë·∫°o / h·∫Øc ƒë·∫°o\nconst hoangDao = extractGioBlock(html, 'Gi·ªù Ho√†ng ƒë·∫°o');\nconst hacDao = extractGioBlock(html, 'Gi·ªù H·∫Øc ƒë·∫°o');\n\n// Ng≈© h√†nh tr·∫°ch nh·∫≠t\nconst nh = extractNguHanhTrachNhat(html);\n\n// Tr·ª±c ng√†y\nconst trucTbl = extractTableByTitle(html, /Xem ng√†y t·ªët x·∫•u theo tr·ª±c/i);\nconst trucNgay = stripTags(trucTbl).replace(/Xem ng√†y t·ªët x·∫•u theo tr·ª±c/i, '').trim();\n\n// Tu·ªïi xung kh·∫Øc\nconst { xungNgay, xungThang } = extractTuoiXungKhac(html);\n\n// Ng·ªçc h·∫°p\nconst nhap = extractNgocHap(html);\n\n// Xu·∫•t h√†nh\nconst { hy, tai } = extractXuatHanh(html);\n\n// Kh·ªïng Minh\nconst km = extractKhongMinh(html);\n\n// L√Ω Thu·∫ßn Phong\nconst ltp = extractLyThuanPhong(html);\n\n// ---------- K·∫æT QU·∫¢ THEO B·ªê C·ª§C ----------\nconst text =\n`\n\n‚è∞ Gi·ªù ho√†ng ƒë·∫°o ‚Äì h·∫Øc ƒë·∫°o\n\nGi·ªù Ho√†ng ƒë·∫°o (t·ªët):\n${hoangDao.length ? hoangDao.map(x => `${x.time} (${x.diaChi} ‚Äì ${x.sao})`).join('\\n') : 'Kh√¥ng c√≥ d·ªØ li·ªáu'}\n\nGi·ªù H·∫Øc ƒë·∫°o (x·∫•u):\n${hacDao.length ? hacDao.map(x => `${x.time} (${x.diaChi} ‚Äì ${x.sao})`).join('\\n') : 'Kh√¥ng c√≥ d·ªØ li·ªáu'}\n\nüìú Ng≈© h√†nh (tr·∫°ch nh·∫≠t)\n\nNi√™n m·ªánh: ${nh.nienMenh || ''}\n${nh.ngayCat ? (nh.ngayCat[0].toUpperCase() + nh.ngayCat.slice(1)) : ''}\nK·ªµ tu·ªïi: ${nh.kyTuoi.length ? nh.kyTuoi.join(', ') : ''}\nH·ª£p & xung: ${nh.hopXungLine || ''}\n${nh.tamSat ? `Tam S√°t k·ªã m·ªánh tu·ªïi: ${nh.tamSat}` : ''}\n\nüìÖ Tr·ª±c ng√†y\n\n${trucNgay || 'Kh√¥ng c√≥ d·ªØ li·ªáu'}\n\n‚öñ Tu·ªïi xung kh·∫Øc\n\nXung ng√†y: ${xungNgay.length ? xungNgay.join(', ') : 'Kh√¥ng c√≥ d·ªØ li·ªáu'}\nXung th√°ng: ${xungThang.length ? xungThang.join(', ') : 'Kh√¥ng c√≥ d·ªØ li·ªáu'}\n\nüí† Ng·ªçc h·∫°p th√¥ng th∆∞\n\nSao t·ªët:\n${nhap.good.length ? nhap.good.map(g => `${g.sao}: ${g.note}`).join('\\n') : 'Kh√¥ng c√≥ d·ªØ li·ªáu'}\n\nSao x·∫•u:\n${nhap.bad.length ? nhap.bad.map(b => `${b.sao}: ${b.note}`).join('\\n') : 'Kh√¥ng c√≥ d·ªØ li·ªáu'}\n\nüß≠ Xu·∫•t h√†nh\n\nH·ª∑ th·∫ßn: ${hy ? `${hy} (t·ªët)` : 'Kh√¥ng c√≥ d·ªØ li·ªáu'}\nT√†i th·∫ßn: ${tai ? `${tai} (t·ªët)` : 'Kh√¥ng c√≥ d·ªØ li·ªáu'}\n\nNg√†y xu·∫•t h√†nh theo Kh·ªïng Minh:\n${km.ten ? `${km.ten} (${km.danhGia === 'T·ªêT' ? 'T·ªët' : 'X·∫•u'}) ‚Äì ${km.moTa}` : 'Kh√¥ng c√≥ d·ªØ li·ªáu'}\n\n‚è≥ Gi·ªù xu·∫•t h√†nh theo L√Ω Thu·∫ßn Phong\n\nX·∫•u: ${ltp.xau.length ? ltp.xau.join(', ') : 'Kh√¥ng c√≥ d·ªØ li·ªáu'}\nT·ªët: ${ltp.tot.length ? ltp.tot.join(', ') : 'Kh√¥ng c√≥ d·ªØ li·ªáu'}\n`.replace(/[ \\t]+\\n/g, '\\n').trim();\n\nreturn [{ json: { text } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1936,1744],"id":"711baddc-034e-4d22-b891-77ebcdf304ec","name":"chitiet"},{"parameters":{"jsCode":"function decodeHtmlEntities(str) {\n  if (!str) return '';\n  str = str.replace(/&#(\\d+);/g, (_, code) => String.fromCharCode(parseInt(code, 10)));\n  str = str.replace(/&#x([0-9a-fA-F]+);/g, (_, code) => String.fromCharCode(parseInt(code, 16)));\n  const map = { '&nbsp;': ' ', '&amp;': '&', '&lt;': '<', '&gt;': '>', '&quot;': '\"', '&apos;': \"'\" };\n  return str.replace(/&[a-zA-Z]+;/g, m => map[m] || m);\n}\n\nfunction stripTags(str) {\n  return decodeHtmlEntities(String(str || '')\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<[^>]*>/g, ''))\n    .replace(/\\u00A0/g, ' ')\n    .trim();\n}\n\n// L·∫•y b·∫£ng <table class=\"table1\"> ƒë·∫ßu ti√™n trong HTML\nfunction firstTable1(html) {\n  const m = html.match(/<table[^>]*class=\"[^\"]*\\btable1\\b[^\"]*\"[^>]*>[\\s\\S]*?<\\/\\s*table\\s*>/i);\n  return m ? m[0] : '';\n}\n\n// B·∫Øt gi√° tr·ªã theo nh√£n b√™n tr√°i trong c√πng m·ªôt <tr>\nfunction textAfter(label, htmlScope) {\n  const re = new RegExp(\n    `<tr>\\\\s*<td[^>]*>\\\\s*${label}\\\\s*<\\\\/\\\\s*td\\\\s*>\\\\s*<td[^>]*>([\\\\s\\\\S]*?)<\\\\/\\\\s*td\\\\s*>\\\\s*<\\\\/\\\\s*tr\\\\s*>`,\n    'i'\n  );\n  const m = htmlScope.match(re);\n  return m ? stripTags(m[1]) : '';\n}\n\n// ---------- B·∫ÆT ƒê·∫¶U ----------\n\nconst html = String(items?.[0]?.json?.data || '');\n\n// L·∫•y b·∫£ng ƒë·∫ßu (th√¥ng tin ng√†y th√°ng‚Ä¶)\nconst infoTable = firstTable1(html);\n\n// C√°c tr∆∞·ªùng trong b·∫£ng ƒë·∫ßu\nconst duongLich = textAfter('D∆∞∆°ng l·ªãch', infoTable);\nconst amLich    = textAfter('√Çm l·ªãch', infoTable).replace(/\\s+/g, ' ').trim();\nconst canChi    = textAfter('Can chi', infoTable);\nconst nguHanh   = textAfter('Ng≈© h√†nh', infoTable);\nconst loaiNgay  = textAfter('Ng√†y', infoTable);\nconst tietKhi   = stripTags(\n  (infoTable.match(/Ti·∫øt Kh√≠[\\s\\S]*?<td[^>]*>([\\s\\S]*?)<\\/\\s*td\\s*>/i)?.[1]) || ''\n);\n\n// ---------- K·∫æT QU·∫¢ ----------\nconst text =\n`\n‚Ä¢ D∆∞∆°ng l·ªãch: ${duongLich || ''}\n‚Ä¢ √Çm l·ªãch: ${amLich || ''}\n‚Ä¢ Can chi: ${canChi || ''}\n‚Ä¢ Ng≈© h√†nh: ${nguHanh || ''}\n‚Ä¢ Ng√†y: ${loaiNgay || ''}\n‚Ä¢ Ti·∫øt kh√≠: ${tietKhi || ''}\nC√°c m·ª•c chi ti·∫øt: Gi·ªù ho√†ng ƒë·∫°o / h·∫Øc ƒë·∫°o, Ng≈© h√†nh (tr·∫°ch nh·∫≠t), Tr·ª±c ng√†y, Tu·ªïi xung kh·∫Øc, Ng·ªçc h·∫°p th√¥ng th∆∞ (sao t·ªët, sao x·∫•u), Xu·∫•t h√†nh, Xu·∫•t h√†nh theo Kh·ªïng Minh, Gi·ªù xu·∫•t h√†nh theo L√Ω Thu·∫ßn Phong\n`.replace(/[ \\t]+\\n/g, '\\n').trim();\n\nreturn [{ json: { text } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1904,1936],"id":"a4b6c27e-70b5-476d-86c6-38aa8bc9a2e3","name":"ngaythang"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"75e7b36f-3fc3-459d-a807-1e83af718c98","leftValue":"={{ $('Start').item.json.chitiet }}","rightValue":"0","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1472,1600],"id":"66e65f5f-eadf-4fcb-b5dc-ceb125ad6097","name":"If4"},{"parameters":{"jsCode":"// Chu·∫©n h√≥a ng√†y v·ªÅ DD-MM-YYYY (m·∫∑c ƒë·ªãnh m√∫i gi·ªù local c·ªßa m√°y ch·∫°y n8n)\nfunction formatDate(date) {\n  const dd = String(date.getDate()).padStart(2, '0');\n  const mm = String(date.getMonth() + 1).padStart(2, '0');\n  const yyyy = date.getFullYear();\n  return `${dd}-${mm}-${yyyy}`;\n}\n\nfunction isValidDate(d) {\n  return d instanceof Date && !isNaN(d.getTime());\n}\n\nfunction parseDate(input) {\n  if (input === null || input === undefined) return 'Invalid date';\n  let raw = String(input).trim();\n\n  if (!raw) return 'Invalid date';\n\n  // M·ªôt s·ªë t·ª´ kh√≥a ti·∫øng Vi·ªát/Anh\n  const lower = raw.toLowerCase();\n  const now = new Date();\n  if (['today', 'hom nay', 'h√¥m nay'].includes(lower)) {\n    return formatDate(now);\n  }\n  if (['yesterday', 'hom qua', 'h√¥m qua'].includes(lower)) {\n    const y = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 1);\n    return formatDate(y);\n  }\n\n  // N·∫øu l√† s·ªë: epoch seconds/ms\n  if (/^\\d+$/.test(raw)) {\n    const n = Number(raw);\n    const ms = n < 1e12 ? n * 1000 : n; // < 10^12 coi l√† seconds\n    const d = new Date(ms);\n    return isValidDate(d) ? formatDate(d) : 'Invalid date';\n  }\n\n  // Th·ª≠ chu·∫©n ISO (YYYY-MM-DD, YYYY/MM/DD, YYYY.MM.DD)\n  let m = raw.match(/^(\\d{4})[\\/\\-.](\\d{1,2})[\\/\\-.](\\d{1,2})$/);\n  if (m) {\n    let [, y, mo, da] = m.map(Number);\n    const d = new Date(y, mo - 1, da);\n    return isValidDate(d) && d.getFullYear() === y && (d.getMonth() + 1) === mo && d.getDate() === da\n      ? formatDate(d)\n      : 'Invalid date';\n  }\n\n  // Th·ª≠ ƒë·ªãnh d·∫°ng D-M-Y ho·∫∑c D/M/Y (2 ho·∫∑c 4 ch·ªØ s·ªë nƒÉm)\n  m = raw.match(/^(\\d{1,2})[\\/\\-.](\\d{1,2})[\\/\\-.](\\d{2}|\\d{4})$/);\n  if (m) {\n    let da = Number(m[1]);\n    let mo = Number(m[2]);\n    let y = Number(m[3]);\n    if (y < 100) y += 2000; // 2 ch·ªØ s·ªë ‚Üí gi·∫£ ƒë·ªãnh 20xx\n    const d = new Date(y, mo - 1, da);\n    return isValidDate(d) && d.getFullYear() === y && (d.getMonth() + 1) === mo && d.getDate() === da\n      ? formatDate(d)\n      : 'Invalid date';\n  }\n\n  // C·ªë g·∫Øng ƒë·ªÉ JS t·ª± parse (c√°c chu·ªói nh∆∞ \"2025-08-26T12:34:56Z\")\n  const auto = new Date(raw);\n  if (isValidDate(auto)) return formatDate(auto);\n\n  return 'Invalid date';\n}\n\n// Map qua c√°c items v√† ghi ƒë√® tr∆∞·ªùng date (ho·∫∑c ƒë·ªïi t√™n n·∫øu mu·ªën)\nreturn items.map(item => {\n  const raw = item.json.date ?? ''; // ƒë·ªïi 'date' th√†nh t√™n field b·∫°n d√πng\n  const formatted = parseDate(raw);\n  return {\n    json: {\n      ...item.json,\n      date: formatted,          // ghi ƒë√® v√†o \"date\"\n      // date_formatted: formatted, // ho·∫∑c d√πng field m·ªõi, t√πy b·∫°n\n      // original_date: raw,        // n·∫øu mu·ªën gi·ªØ gi√° tr·ªã g·ªëc ƒë·ªÉ debug\n    }\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1008,1872],"id":"1e4441c2-df5d-44dc-9b19-89365ac2a0dd","name":"Code14"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Start').item.json.chitiet }}","rightValue":"yes","operator":{"type":"string","operation":"equals"},"id":"3a24a101-af1a-4846-9fbd-4d810e1e0b1c"}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0f322065-c211-4e8f-9695-05e9f6fb275f","leftValue":"={{ $('Start').item.json.chitiet }}","rightValue":"yes","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"}}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[1456,1856],"id":"bb8ce607-709d-4537-873f-1c5eb47fa620","name":"Switch"}],"connections":{"vannien":{"main":[[{"node":"Switch","type":"main","index":0}]]},"If4":{"main":[[],[]]},"Code14":{"main":[[{"node":"vannien","type":"main","index":0}]]},"Start":{"main":[[{"node":"Code14","type":"main","index":0}]]},"Switch":{"main":[[{"node":"chitiet","type":"main","index":0}],[{"node":"ngaythang","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{"Start":[{"json":{"chitiet":"yes","type":"0","date":"02-09-2025"}}]},"versionId":"d778b108-d74f-484b-b5b9-21e68fd4ddfa","triggerCount":0,"shared":[{"createdAt":"2025-08-25T16:44:29.202Z","updatedAt":"2025-08-25T16:44:29.202Z","role":"workflow:owner","workflowId":"C4LlOyeO1AXflv4i","projectId":"Bsx4kBdHQHZGGC5J"}],"tags":[]}