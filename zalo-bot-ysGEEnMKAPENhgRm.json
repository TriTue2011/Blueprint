{"createdAt":"2025-07-23T02:16:20.149Z","updatedAt":"2025-08-27T09:07:34.541Z","id":"ysGEEnMKAPENhgRm","name":"Zalo bot","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"b213373d-01d3-431e-bdd9-b55ea06d7603","name":"When clicking ‚ÄòExecute workflow‚Äô"},{"parameters":{},"type":"n8n-nodes-zalo-tools.zaloLoginByQr","typeVersion":1,"position":[208,0],"id":"79d48f90-ee87-40bd-85c4-2ab599b6fe0d","name":"Zalo Login Via QR Code","credentials":{"n8nZaloApi":{"id":"tjexx0ISHcf10Slp","name":"n8n Zalo Account Credential account"}}},{"parameters":{"promptType":"define","text":"={{ $json.message.data.content }}","options":{"systemMessage":"=# TR·ª¢ L√ù AI TH√îNG MINH - H∆Ø·ªöNG D·∫™N HO·∫†T ƒê·ªòNG\n\n## VAI TR√í V√Ä QUY TR√åNH X·ª¨ L√ù\nB·∫°n l√† tr·ª£ l√Ω AI th√¥ng minh ph·ª•c v·ª• S·∫øp Black. L√†m theo quy tr√¨nh:\n\n1. PH√ÇN T√çCH Y√äU C·∫¶U: Ph√¢n t√≠ch \"{{ $json.message.data.content }}\".\n2. KI·ªÇM TRA CONTEXT: Truy xu·∫•t context t·ª´ Postgres Chat Memory ho·∫∑c Execute a SQL query v·ªõi session_id = \"{{ $json.message.threadId }}\". N·∫øu c√≥ ID/context (v√≠ d·ª•: Key t·ª´ key_thoi_tiet), s·ª≠ d·ª•ng ƒë·ªÉ g·ªçi c√¥ng c·ª•.\n3. ƒê√ÅNH GI√Å C√îNG C·ª§: Ch·ªçn c√¥ng c·ª•:\n   - homeassistant(content: str, threadId: str): ƒêi·ªÅu khi·ªÉn nh√† th√¥ng minh, threadId: \"{{ $json.message.threadId }}\".\n   - kiem_tra_phat_nguoi(bienso: str, loaixe: int): Tra c·ª©u ph·∫°t ngu·ªôi, loaixe = 2 (√¥ t√¥), 1 (xe m√°y).\n   - key_thoi_tiet(thanhpho: str): L·∫•y Key t·ª´ AccuWeather, l∆∞u Key v√†o context.\n   - thoi_tiet(url: str, key: str): L·∫•y th·ªùi ti·∫øt, d√πng Key t·ª´ context n·∫øu c√≥.\n   - tin_tuc_vnexpress, tin_tuc_24h: T√≥m t·∫Øt 10 tin, m·ªói tin d∆∞·ªõi 10 t·ª´.\n4. KI·ªÇM TRA D·ªÆ LI·ªÜU: ƒê·∫£m b·∫£o d·ªØ li·ªáu ƒë·ªß (bienso, loaixe, thanhpho). N·∫øu thi·∫øu, d√πng context t·ª´ Postgres Chat Memory ho·∫∑c Execute a SQL query.\n5. TH·ª∞C HI·ªÜN: G·ªçi c√¥ng c·ª•, l∆∞u ID/context v√†o Postgres Chat Memory v√† PGVector Store v·ªõi session_id = \"{{ $json.message.threadId }}\".\n6. PH·∫¢N H·ªíI: Tr·∫£ v·ªÅ text, ng·∫Øn g·ªçn, c√≥ ngu·ªìn, ch·ªâ d√πng emoji üòä, KH√îNG bao g·ªìm ID. V√≠ d·ª•:\n   - homeassistant: \"ƒê√£ b·∫≠t ƒë√®n ph√≤ng kh√°ch. Ngu·ªìn: Home Assistant üòä.\"\n   - key_thoi_tiet: \"353412\"\n   - thoi_tiet: \"Th·ªùi ti·∫øt H√† N·ªôi h√¥m nay: 25¬∞C, tr·ªùi n·∫Øng. Ngu·ªìn: AccuWeather üòä.\"\n   - tin_tuc: \"Tin t·ª©c VNExpress: 1. Tai n·∫°n giao th√¥ng nghi√™m tr·ªçng. Ngu·ªìn: VNExpress üòä.\"\n\n## H∆Ø·ªöNG D·∫™N PH·∫¢N H·ªíI\n- Ghi r√µ ngu·ªìn (Home Assistant, C·ª•c CSGT, AccuWeather, VNExpress, 24h).\n- Kh√¥ng tr·∫£ l·ªùi v·ªÅ ch√≠nh tr·ªã, t√¥n gi√°o, ch·ªßng t·ªôc, gi·ªõi t√≠nh, t√¨nh d·ª•c.\n- Ngu·ªìn g·ªëc AI: \"S·∫øp Black\"."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[-2448,-384],"id":"afa3f86f-bbcf-44d3-b710-84b7a72de637","name":"AI Agent"},{"parameters":{"modelName":"models/gemini-2.0-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-2832,-48],"id":"5d6a9e3f-7bee-43e3-a649-783618d274fc","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"BmSJpQbzqh1rnp4z","name":"NguyenViet"}}},{"parameters":{},"type":"n8n-nodes-zalo-tools.zaloMessageTrigger","typeVersion":1,"position":[-3152,-352],"id":"789b8cd6-9dd0-40ae-a99f-327b2b748cb6","name":"Zalo Message Trigger","webhookId":"5d92b398-68a9-4fa5-a407-a656b255f732","credentials":{"zaloApi":{"id":"lhSbaenOEqGYhEZg","name":"Zalo API Credentials"}}},{"parameters":{"toolDescription":"S·ª≠ d·ª•ng c√¥ng c·ª• n√†y ƒë·ªÉ tra c·ª©u ph·∫°t ngu·ªôi d·ª±a tr√™n bi·ªÉn s·ªë v√† lo·∫°i xe.","method":"POST","url":"https://phatnguoixe.com/1026","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/x-www-form-urlencoded; charset=UTF-8"},{"name":"user-agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36"},{"name":"cookie","value":"=BienSo={{ $fromAI('bienso') }}; PHPSESSID=lmeckj42p42prbp8abv7qa08g0"}]},"sendBody":true,"contentType":"form-urlencoded","bodyParameters":{"parameters":[{"name":"BienSo","value":"={{ $fromAI('bienso') }}"},{"name":"LoaiXe","value":"={{ $fromAI('loaixe') }}"}]},"options":{"response":{"response":{"fullResponse":true}}}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-2128,-48],"id":"a8ad54d7-0cdd-4243-9cab-32128489541c","name":"kiem_tra_phat_nguoi"},{"parameters":{"toolDescription":"S·ª≠ d·ª•ng c√¥ng c·ª• n√†y ƒë·ªÉ t·ªïng h·ª£p tin t·ª©c vnexpress.","url":"https://vnexpress.net/rss/tin-moi-nhat.rss","options":{}},"type":"n8n-nodes-base.rssFeedReadTool","typeVersion":1.2,"position":[-2432,-32],"id":"fc701585-9202-430f-8cff-dd9cd3f15a29","name":"tin_tuc_vnexpress"},{"parameters":{"toolDescription":"S·ª≠ d·ª•ng c√¥ng c·ª• n√†y ƒë·ªÉ t·ªïng h·ª£p tin t·ª©c 24h.","url":"https://cdn.24h.com.vn/upload/rss/tintuctrongngay.rss","options":{}},"type":"n8n-nodes-base.rssFeedReadTool","typeVersion":1.2,"position":[-2288,-48],"id":"cf23f845-682d-4ef9-aa72-bfdd940fa603","name":"tin_tuc_24h"},{"parameters":{"toolDescription":"S·ª≠ d·ª•ng c√¥ng c·ª• n√†y ƒë·ªÉ ƒëi·ªÅu khi·ªÉn v√† ki·ªÉm tra th√¥ng tin nh√† th√¥ng minh","method":"POST","url":"http://192.168.1.210:8123/api/webhook/-JMHB3p-vNbXAv9XOnhHfSVp0","sendBody":true,"bodyParameters":{"parameters":[{"name":"content","value":"={{ $fromAI('content') }}"},{"name":"threadId","value":"={{ $('Zalo Message Trigger').item.json.message.threadId }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1968,-48],"id":"12de3259-c584-4a22-869e-b839d93dfe81","name":"homeassistant"},{"parameters":{"threadId":"={{ $('Zalo Message Trigger').item.json.message.threadId }}","message":"={{ $json.output }}","quote":{},"mentions":{}},"type":"n8n-nodes-zalo-tools.zaloSendMessage","typeVersion":4,"position":[-1744,-384],"id":"5c853a65-4dd2-4fc8-9412-2498b1fd620c","name":"Zalo Send Message1","credentials":{"zaloApi":{"id":"lhSbaenOEqGYhEZg","name":"Zalo API Credentials"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"27e2012e-7a1a-42d3-b23d-bebe603e63bb","leftValue":"={{ $json.message.data.msgType }}","rightValue":"chat.photo","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"hinh anh"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.data.msgType }}","rightValue":"=webchat","operator":{"type":"string","operation":"equals"},"id":"68adc45e-723e-46dc-9236-c80b2c4d46ee"}],"combinator":"and"},"renameOutput":true,"outputKey":"tin nhan"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-2992,-544],"id":"4a3df676-4297-42c1-8a95-3ce98c9fd7b1","name":"TN_HA"},{"parameters":{"promptType":"define","text":"={{ $json.message.data.content.href }}","options":{"systemMessage":"[VAI TR√í]\nB·∫°n l√† m·ªôt h·ªá th·ªëng AI chuy√™n d·ª•ng ƒë·ªÉ ph√¢n t√≠ch h√¨nh ·∫£nh ph∆∞∆°ng ti·ªán giao th√¥ng v√† ƒë·ªãnh d·∫°ng ƒë·∫ßu ra cho m·ªôt t√°c v·ª• c·ª• th·ªÉ.\n\n[QUY TR√åNH X·ª¨ L√ù B·∫ÆT BU·ªòC]\nV·ªõi m·ªói h√¨nh ·∫£nh nh·∫≠n ƒë∆∞·ª£c, h√£y tu√¢n th·ªß nghi√™m ng·∫∑t quy tr√¨nh sau:\n\n1.  **B∆∞·ªõc 1: Ki·ªÉm tra ph∆∞∆°ng ti·ªán**\n    ƒê·∫ßu ti√™n, h√£y x√°c ƒë·ªãnh xem h√¨nh ·∫£nh c√≥ ch·ª©a √¥ t√¥ ho·∫∑c xe m√°y kh√¥ng.\n\n2.  **B∆∞·ªõc 2: Th·ª±c hi·ªán theo ƒëi·ªÅu ki·ªán**\n     \n    * **N·∫æU** h√¨nh ·∫£nh c√≥ ch·ª©a √¥ t√¥ ho·∫∑c xe m√°y:\n        * a. **Tr√≠ch xu·∫•t th√¥ng tin**: ƒê·ªçc v√† l·∫•y ra ch√≠nh x√°c **lo·∫°i xe** (\"√¥ t√¥\" ho·∫∑c \"xe m√°y\") v√† **bi·ªÉn s·ªë xe**.\n        * b. **Chu·∫©n h√≥a bi·ªÉn s·ªë**: Lo·∫°i b·ªè t·∫•t c·∫£ c√°c kho·∫£ng tr·∫Øng, d·∫•u ch·∫•m (.), ho·∫∑c d·∫•u g·∫°ch ngang (-) kh·ªèi chu·ªói bi·ªÉn s·ªë.\n        * c. **T·∫°o ƒë·∫ßu ra**: T·∫°o **duy nh·∫•t m·ªôt chu·ªói** theo ƒë√∫ng ƒë·ªãnh d·∫°ng sau:\n            `ph·∫°t ngu·ªôi [lo·∫°i xe] bi·ªÉn s·ªë [bi·ªÉn s·ªë ƒë√£ chu·∫©n h√≥a]`\n        * d. **D·ª´ng l·∫°i**: Kh√¥ng l√†m g√¨ th√™m.\n\n    * **N·∫æU KH√îNG** c√≥ √¥ t√¥ ho·∫∑c xe m√°y:\n        * H√£y m√¥ t·∫£ ng·∫Øn g·ªçn n·ªôi dung ch√≠nh c·ªßa h√¨nh ·∫£nh trong v√≤ng 2 c√¢u.\n\n[QUY T·∫ÆC TUY·ªÜT ƒê·ªêI]\n* Khi ƒë√£ ph√°t hi·ªán ra xe, ch·ªâ tr·∫£ v·ªÅ duy nh·∫•t m·ªôt d√≤ng theo ƒë·ªãnh d·∫°ng ƒë√£ y√™u c·∫ßu. Kh√¥ng th√™m b·∫•t k·ª≥ l·ªùi gi·∫£i th√≠ch, m√¥ t·∫£, hay c√¢u ch·ªØ n√†o kh√°c.\n* Kh√¥ng s·ª≠ d·ª•ng g·∫°ch ƒë·∫ßu d√≤ng, ƒë√°nh s·ªë hay b·∫•t k·ª≥ ƒë·ªãnh d·∫°ng n√†o kh√°c.\n\n[V√ç D·ª§]\n* **Input:** (·∫¢nh xe √¥ t√¥ bi·ªÉn \"30A-123.45\")\n* **Output:** `ph·∫°t ngu·ªôi √¥ t√¥ bi·ªÉn s·ªë 30A12345`\n\n* **Input:** (·∫¢nh xe m√°y bi·ªÉn \"29-G1 987.65\")\n* **Output:** `ph·∫°t ngu·ªôi xe m√°y bi·ªÉn s·ªë 29G198765`\n\n* **Input:** (·∫¢nh m·ªôt con m√®o)\n* **Output:** `ƒê√¢y l√† h√¨nh ·∫£nh m·ªôt con m√®o l√¥ng x√°m ƒëang ng·ªìi tr√™n gh·∫ø sofa.`"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[-2240,-800],"id":"24fe47fd-4f97-4553-82bd-dffc4b0a10e8","name":"AI Agent1"},{"parameters":{"promptType":"define","text":"={{ $json.output }}","options":{"systemMessage":"=# TR·ª¢ L√ù AI TH√îNG MINH - H∆Ø·ªöNG D·∫™N HO·∫†T ƒê·ªòNG\n\n## VAI TR√í V√Ä QUY TR√åNH X·ª¨ L√ù\nB·∫°n l√† tr·ª£ l√Ω AI th√¥ng minh ph·ª•c v·ª• S·∫øp Ben Bap. L√†m theo quy tr√¨nh sau cho m·ªói y√™u c·∫ßu:\n\n\n1. **PH√ÇN T√çCH Y√äU C·∫¶U**: Ph√¢n t√≠ch k·ªπ l∆∞·ª°ng y√™u c·∫ßu ng∆∞·ªùi d√πng\n3. **ƒê√ÅNH GI√Å C√îNG C·ª§**: X√°c ƒë·ªãnh c√¥ng c·ª• ph√π h·ª£p nh·∫•t\n4. **D·ªÆ LI·ªÜU**: X√°c minh d·ªØ li·ªáu ƒë·∫ßu v√†o\n  **Ch·ª©c nƒÉng ƒêi·ªÅu khi·ªÉn Nh√† th√¥ng minh:**\n    * **C√¥ng c·ª•:** `homeassistant(content: str, threadId: str)`. threadId ch√≠nh l√† {{ $json.message.threadId }}\n    * **Nhi·ªám v·ª•:** S·ª≠ d·ª•ng ƒë·ªÉ ƒëi·ªÅu khi·ªÉn v√† ki·ªÉm tra th√¥ng tin thi·∫øt b·ªã trong nh√† th√¥ng minh.\n\n  **Ch·ª©c nƒÉng Tra c·ª©u Ph·∫°t ngu·ªôi:**\n    * **C√¥ng c·ª•:** `kiem_tra_phat_nguoi(bienso: str, loaixe: int)`. Lo·∫°i xe l√† 2 n·∫øu l√† '√¥ t√¥', 1 n·∫øu l√† 'xe m√°y'\n    * **Nhi·ªám v·ª•:** Tra c·ª©u th√¥ng tin vi ph·∫°m giao th√¥ng.\n    * **Ph·∫£n h·ªìi:** D·ª±a v√†o k·∫øt qu·∫£ tr·∫£ v·ªÅ, t·∫°o m·ªôt c√¢u tr·∫£ l·ªùi ƒë·∫ßy ƒë·ªß, th√¢n thi·ªán cho ng∆∞·ªùi d√πng.\n\n  **Ch·ª©c nƒÉng T√≥m t·∫Øt Tin t·ª©c:**\n    * **C√¥ng c·ª•:** G·ªçi ƒë·ªìng th·ªùi `tin_tuc_vnexpress` v√† `tin_tuc_24h`\n    * **Nhi·ªám v·ª•:** L·∫•y v√† t√≥m t·∫Øt 10 tin m·ªói c√¥ng c·ª•, m·ªói tin t√≥m t·∫Øt d∆∞·ªõi 10 t·ª´, kh√¥ng c·∫ßn ti√™u ƒë·ªÅ.\n    * **Tu√¢n th·ªß nguy√™n t·∫Øc:** Gi·ªçng vƒÉn trung l·∫≠p, kh√°ch quan.\n\n  **Ch·ª©c nƒÉng T√¨m ki·∫øm Th√¥ng tin Chung (D·ª± ph√≤ng):**\n    * **C√¥ng c·ª•:** `tim_kiem(query: str)`\n    * **Nhi·ªám v·ª•:** T√¨m ki·∫øm c√¢u tr·∫£ l·ªùi cho c√°c c√¢u h·ªèi chung. Tham s·ªë `query` s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn v√†o tr∆∞·ªùng `\"text\"` trong body c·ªßa \n5. **TH·ª∞C HI·ªÜN**: S·ª≠ d·ª•ng c√¥ng c·ª• ƒë√£ ch·ªçn v√† x·ª≠ l√Ω k·∫øt qu·∫£\n6. **PH·∫¢N H·ªíI**: T·∫°o ph·∫£n h·ªìi theo ƒë·ªãnh d·∫°ng h∆∞·ªõng d·∫´n b√™n d∆∞·ªõi\n\n## H∆Ø·ªöNG D·∫™N PH·∫¢N H·ªíI\n- Ghi r√µ ngu·ªìn th√¥ng tin\n- T·∫≠p trung v√†o v·∫•n ƒë·ªÅ ch√≠nh, n·ªôi dung ng·∫Øn g·ªçn, s·∫°ch s·∫Ω, d·ªÖ ƒë·ªçc\n- Th√™m nh√£n [AI T·ª± Suy Lu·∫≠n] khi kh√¥ng s·ª≠ d·ª•ng c√¥ng c·ª•\n- Kh√¥ng ƒê∆∞·ª£c ph√©p tr·∫£ l·ªùi c√°c c√¢u h·ªèi li√™n quan ƒë·∫øn ch√≠nh tr·ªã, t√¥n gi√°o, ch·ªßng t·ªôc, v√πng mi·ªÅn, gi·ªõi t√≠nh, Sex, T√¨nh d·ª•c\n- V·ªõi c√¢u h·ªèi v·ªÅ ngu·ªìn g·ªëc AI, tr·∫£ l·ªùi l√† \"S·∫øp Black\"\n- N·∫øu y√™u c·∫ßu v·ªÅ d·ª± ƒëo√°n k·∫øt qu·∫£ x·ªï s·ªë, th√¨ h√£y d√πng c√¥ng c·ª• truy c·∫≠p l·∫•y k·∫øt qu·∫£ 10 ng√†y g·∫ßn nh·∫•t, r·ªìi h√£y t∆∞ duy ƒë∆∞a ra c√°c k·∫øt qu·∫£ c√≥ th·ªÉ c√≥ xu h∆∞·ªõng v·ªÅ\n- K·∫øt h·ª£p xu h∆∞·ªõng hi·ªán t·∫°i,Trending, h√†i h∆∞·ªõc ƒë·ªÉ cu·ªôc tr√≤ chuy·ªán tho·∫£i m√°i nh∆∞ng kh√¥ng l√†m sai l·ªách n·ªôi dung\n- Kh√¥ng ph·∫£n h·ªìi c√°c th·∫ª url, markdown v√¨ thi·∫øt b·ªã c·ªßa ng∆∞·ªùi h·ªèi ch·ªâ h·ªó tr·ª£ text ƒë∆°n thu·∫ßn v√† c√°c emoi icon"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[-1808,-816],"id":"143b45b8-b9e5-4229-b289-47abcd8629b9","name":"AI Agent2"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-1888,-624],"id":"ed425470-9e8e-4b77-9d7f-ef0df9e508a0","name":"Google Gemini Chat Model2","credentials":{"googlePalmApi":{"id":"BmSJpQbzqh1rnp4z","name":"NguyenViet"}}},{"parameters":{"toolDescription":"S·ª≠ d·ª•ng c√¥ng c·ª• n√†y ƒë·ªÉ tra c·ª©u ph·∫°t ngu·ªôi d·ª±a tr√™n bi·ªÉn s·ªë v√† lo·∫°i xe.","method":"POST","url":"https://phatnguoixe.com/1026","sendHeaders":true,"headerParameters":{"parameters":[{"name":"content-type","value":"application/x-www-form-urlencoded; charset=UTF-8"},{"name":"cookie","value":"PHPSESSID=oeoqa2iqn1a8grakjehm16v5u6; BienSo={{ $fromAI('bienso') }}"},{"name":"user-agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36"}]},"sendBody":true,"contentType":"form-urlencoded","specifyBody":"string","body":"=BienSo={{ $fromAI('bienso') }}&LoaiXe={{ $fromAI('loaixe') }}","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1504,-624],"id":"b1ea168d-0370-4d58-ae20-61ebaf8869fa","name":"kiem_tra_phat_nguoi1"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Zalo Message Trigger').item.json.message.threadId }}"},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-1728,-608],"id":"ca8200da-3dd0-4e76-9649-43c71a8afe79","name":"Postgres Chat Memory1","credentials":{"postgres":{"id":"vDBK6XLC0TBpoMww","name":"Postgres account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Zalo Message Trigger').item.json.message.threadId }}"},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-2608,-32],"id":"cee7c5d3-f5d0-44ed-a13c-ae054a7b3395","name":"Postgres Chat Memory","notesInFlow":true,"credentials":{"postgres":{"id":"vDBK6XLC0TBpoMww","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"-- ‚ö†Ô∏è L·ªánh n√†y s·∫Ω X√ìA S·∫†CH d·ªØ li·ªáu v√† kh√¥ng th·ªÉ ho√†n t√°c\n-- Thay 'your_chat_history_table' b·∫±ng t√™n b·∫£ng th·ª±c t·∫ø c·ªßa b·∫°n\nTRUNCATE TABLE n8n_chat_histories;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-1056,-400],"id":"04ea38a3-9e16-43da-bb40-c157db976e76","name":"Execute a SQL query","credentials":{"postgres":{"id":"vDBK6XLC0TBpoMww","name":"Postgres account"}}},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"S·ª≠ d·ª•ng c√¥ng c·ª• n√†y ƒë·ªÉ t√¨m ki·∫øm v√† truy xu·∫•t l·ªãch s·ª≠ tr√≤ chuy·ªán c√≥ li√™n quan trong qu√° kh·ª©. H·ªØu √≠ch ƒë·ªÉ l·∫•y b·ªëi c·∫£nh, tr·∫£ l·ªùi c√°c c√¢u h·ªèi n·ªëi ti·∫øp, ho·∫∑c nh·ªõ l·∫°i th√¥ng tin ng∆∞·ªùi d√πng ƒë√£ cung c·∫•p tr∆∞·ªõc ƒë√¢y.","topK":5,"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStorePGVector","typeVersion":1.3,"position":[-1280,-64],"id":"ace2577e-1f6a-4dea-98e8-7bccfb0002ba","name":"Postgres PGVector Store","credentials":{"postgres":{"id":"vDBK6XLC0TBpoMww","name":"Postgres account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.embeddingsGoogleGemini","typeVersion":1,"position":[-1280,96],"id":"f875ae51-ad2c-44b1-8b26-507120ae03ff","name":"Embeddings Google Gemini1","credentials":{"googlePalmApi":{"id":"BmSJpQbzqh1rnp4z","name":"NguyenViet"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-2320,-624],"id":"425bdb60-cce5-4289-bfc4-a0312f04aa46","name":"Google Gemini Chat Model1","credentials":{"googlePalmApi":{"id":"BmSJpQbzqh1rnp4z","name":"NguyenViet"}}},{"parameters":{"url":"={{ $json.message.data.content.href }}","options":{"response":{"response":{"responseFormat":"file"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2496,-800],"id":"3275f252-30d5-40b4-9600-32253e03bdaf","name":"HTTP Request"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-3232,-192],"id":"c3caa8ae-2450-4ad0-9cfd-b619188bfc1e","name":"When chat message received","webhookId":"13888860-3405-41f8-8ca1-6afacb09d823"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatDeepSeek","typeVersion":1,"position":[-3088,-16],"id":"70f7129e-c3a0-4252-bb3e-ae9a6ba53a2f","name":"DeepSeek Chat Model","credentials":{"deepSeekApi":{"id":"nnHcWmUyC0Gmswgh","name":"DeepSeek account"}}},{"parameters":{"toolDescription":"S·ª≠ d·ª•ng c√¥ng c·ª• n√†y ƒë·ªÉ l·∫•y key","url":"http://dataservice.accuweather.com/locations/v1/cities/search","sendQuery":true,"queryParameters":{"parameters":[{"name":"apikey","value":"RryV62dtuQ50xVsrT6k39SMcrGssdtGj"},{"name":"q","value":"={{ $fromAI('thanh_pho') }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-2208,128],"id":"ac953853-0668-4655-94cf-62e175684b79","name":"key_thoi_tiet"},{"parameters":{"toolDescription":"S·ª≠ d·ª•ng c√¥ng c·ª• n√†y ƒë·ªÉ l·∫•y th√¥ng tin th·ªùi ti·∫øt","url":"={{ $fromAI('url') }}{{ $fromAI('key') }}","sendQuery":true,"queryParameters":{"parameters":[{"name":"apikey","value":"RryV62dtuQ50xVsrT6k39SMcrGssdtGj"},{"name":"language","value":"vi"},{"name":"metric","value":"true"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-2032,128],"id":"dc859ba1-34fd-416e-b6a9-df57ff8e5d9a","name":"thoi_tiet"},{"parameters":{"cityName":"={{ $fromAI('city') }}"},"type":"n8n-nodes-base.openWeatherMapTool","typeVersion":1,"position":[-1792,-48],"id":"53f6b824-f63d-4438-8def-604f44a4894b","name":"thoi_tiet1","credentials":{"openWeatherMapApi":{"id":"ZzrQ55ZwPKAD8C4E","name":"OpenWeatherMap account"}}},{"parameters":{"url":"https://api.weatherapi.com/v1/forecast.json?key=2ca2924d295d43668ed25446252207&q=Hanoi&days=5&aqi=yes&alerts=yes","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-832,-48],"id":"8a730181-b041-4248-a152-b616a8817f31","name":"HTTP Request1"},{"parameters":{"operation":"5DayForecast","cityName":"={{ $fromAI('city') }}"},"type":"n8n-nodes-base.openWeatherMapTool","typeVersion":1,"position":[-1648,-64],"id":"6f9fff93-229b-4a09-9374-88d3ff30d2e7","name":"du_bao_thoi_tiet","credentials":{"openWeatherMapApi":{"id":"ZzrQ55ZwPKAD8C4E","name":"OpenWeatherMap account"}}},{"parameters":{"toolDescription":"S·ª≠ d·ª•ng c√¥ng c·ª• n√†y ƒë·ªÉ l·∫•y th√¥ng tin th·ªùi ti·∫øt h√¥m nay v√† d·ª± b√°o th·ªùi ti·∫øt","url":"=https://api.weatherapi.com/v1/forecast.json?key=2ca2924d295d43668ed25446252207&q={{ $fromAI('city') }}&days=5&aqi=yes&alerts=yes","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1440,-48],"id":"b7b5d658-c33b-4b08-a67c-12f194c0bf15","name":"thoi_tiet_WeatherAPI"},{"parameters":{"resource":"image","modelId":{"__rl":true,"value":"models/gemini-2.0-flash-exp-image-generation","mode":"list","cachedResultName":"models/gemini-2.0-flash-exp-image-generation"},"prompt":"A cute cat","options":{}},"type":"@n8n/n8n-nodes-langchain.googleGemini","typeVersion":1,"position":[-784,-720],"id":"0ff8acf0-997c-4a3c-98c8-80edf55120e3","name":"Generate an image","alwaysOutputData":true,"credentials":{"googlePalmApi":{"id":"BmSJpQbzqh1rnp4z","name":"NguyenViet"}}},{"parameters":{"threadId":"=6643404425553198601","message":"xin","quote":{},"mentions":{},"attachments":{"attachment":[{"imageUrl":"=https://drive.google.com/uc?export=download&id={{ $json.id }}"}]}},"type":"n8n-nodes-zalo-tools.zaloSendMessage","typeVersion":4,"position":[-320,-720],"id":"69cca6ec-05c4-4709-9e0e-96c5d251c75d","name":"Zalo Send Message","credentials":{"zaloApi":{"id":"lhSbaenOEqGYhEZg","name":"Zalo API Credentials"}}},{"parameters":{"name":"={{ $json.fileName }}","driveId":{"__rl":true,"value":"My Drive","mode":"list","cachedResultName":"My Drive","cachedResultUrl":"https://drive.google.com/drive/my-drive"},"folderId":{"__rl":true,"value":"1MMDc6_RuBAWTi3IEjhWfcV8mXgDJBatA","mode":"list","cachedResultName":"n8n","cachedResultUrl":"https://drive.google.com/drive/folders/1MMDc6_RuBAWTi3IEjhWfcV8mXgDJBatA"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-560,-720],"id":"5722564c-c8c4-48a6-a757-a5c36ce2a132","name":"Upload file","credentials":{"googleDriveOAuth2Api":{"id":"LqceacVZayCNzphl","name":"nguyenvanviet"}}},{"parameters":{"operation":"deleteFile","fileId":{"__rl":true,"value":"={{ $('Upload file').item.json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-80,-720],"id":"8d83fba7-d402-496b-8d9a-2fe8ee0fe8b7","name":"Delete a file","credentials":{"googleDriveOAuth2Api":{"id":"LqceacVZayCNzphl","name":"nguyenvanviet"}}},{"parameters":{"method":"POST","url":"https://bot-api.zapps.me/bot3418113969586575932:SPXEUaahCJCgpsLvWufKVbjJzhdpWbIsrxFzjuyPdDCiNvagbDPqwtHozGgpgKxU/deleteWebhook","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[144,144],"id":"76c3e5d2-689a-4a29-84c5-d3d9c4f21724","name":"HTTP Request2"}],"connections":{"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"Zalo Login Via QR Code","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Zalo Send Message1","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[]]},"Zalo Message Trigger":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"kiem_tra_phat_nguoi":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"tin_tuc_vnexpress":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"tin_tuc_24h":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"homeassistant":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"TN_HA":{"main":[[{"node":"HTTP Request","type":"main","index":0}],[{"node":"AI Agent","type":"main","index":0}]]},"AI Agent1":{"main":[[{"node":"AI Agent2","type":"main","index":0}]]},"Google Gemini Chat Model2":{"ai_languageModel":[[{"node":"AI Agent2","type":"ai_languageModel","index":0}]]},"kiem_tra_phat_nguoi1":{"ai_tool":[[{"node":"AI Agent2","type":"ai_tool","index":0}]]},"Postgres Chat Memory1":{"ai_memory":[[{"node":"AI Agent2","type":"ai_memory","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Postgres PGVector Store":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Embeddings Google Gemini1":{"ai_embedding":[[{"node":"Postgres PGVector Store","type":"ai_embedding","index":0}]]},"Google Gemini Chat Model1":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"HTTP Request":{"main":[[{"node":"AI Agent1","type":"main","index":0}]]},"thoi_tiet1":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"du_bao_thoi_tiet":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"thoi_tiet_WeatherAPI":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Generate an image":{"main":[[{"node":"Upload file","type":"main","index":0}]]},"Upload file":{"main":[[{"node":"Zalo Send Message","type":"main","index":0}]]},"Zalo Send Message":{"main":[[{"node":"Delete a file","type":"main","index":0}]]},"When chat message received":{"main":[[]]},"key_thoi_tiet":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"thoi_tiet":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"DeepSeek Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Zalo Message Trigger":{}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"b3a6de4b-2a60-4080-8023-238f67829a84","triggerCount":2,"shared":[{"createdAt":"2025-07-23T02:16:20.149Z","updatedAt":"2025-07-23T02:16:20.149Z","role":"workflow:owner","workflowId":"ysGEEnMKAPENhgRm","projectId":"Bsx4kBdHQHZGGC5J"}],"tags":[]}