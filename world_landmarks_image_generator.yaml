blueprint:
  name: AI World Landmarks Image Generator
  author: Enhanced by Claude
  description: "# Tá»± Ä‘á»™ng táº¡o áº£nh danh lam tháº¯ng cáº£nh toÃ n tháº¿ giá»›i\n\nâœ¨ TÃ­nh nÄƒng:\n- Tá»± Ä‘á»™ng chá»n ngáº«u nhiÃªn quá»‘c gia hoáº·c theo danh sÃ¡ch tÃ¹y chá»‰nh\n- **Há»— trá»£ áº£nh tham chiáº¿u**: Sá»­ dá»¥ng áº£nh máº«u Ä‘á»ƒ Ä‘á»‹nh hÆ°á»›ng phong cÃ¡ch, mÃ u sáº¯c, Ã¡nh sÃ¡ng\n- Aspect ratio linh hoáº¡t: 16:9, 9:16, 1:1, 4:3, 21:9\n- Táº¡o áº£nh cháº¥t lÆ°á»£ng cao vá»›i prompt Ä‘Æ°á»£c tá»‘i Æ°u\n- LÆ°u áº£nh tá»± Ä‘á»™ng vá»›i tÃªn file cÃ³ thá»ƒ tÃ¹y chá»‰nh\n\nâ° TRIGGER: KÃ­ch hoáº¡t theo chu ká»³ giá» (má»—i X giá»)\nðŸŒ COUNTRY: Chá»n ngáº«u nhiÃªn tá»« 48+ quá»‘c gia, lá»c theo khu vá»±c\nðŸ“¸ STYLE: Photorealistic, Artistic, Vibrant, Cinematic\nðŸ–¼ï¸ REFERENCE: CÃ³ thá»ƒ Ä‘Ã­nh kÃ¨m áº£nh máº«u Ä‘á»ƒ AI há»c phong cÃ¡ch\n"
  domain: automation
  homeassistant:
    min_version: 2024.8.0
  input:
    trigger_settings:
      name: "â° CÃ i Ä‘áº·t kÃ­ch hoáº¡t"
      icon: mdi:clock-outline
      collapsed: false
      input:
        trigger_hours:
          name: "KÃ­ch hoáº¡t má»—i X giá»"
          description: "VÃ­ dá»¥: 6 = má»—i 6 giá», 12 = má»—i 12 giá», 24 = má»—i ngÃ y"
          default: 6
          selector:
            number:
              min: 1
              max: 24
              step: 1
              mode: box
    
    country_settings:
      name: "ðŸŒ CÃ i Ä‘áº·t quá»‘c gia"
      icon: mdi:earth
      collapsed: false
      input:
        use_random_country:
          name: Chá»n ngáº«u nhiÃªn quá»‘c gia
          description: Tá»± Ä‘á»™ng chá»n ngáº«u nhiÃªn tá»« danh sÃ¡ch
          default: true
          selector:
            boolean: {}
        
        specific_country:
          name: Quá»‘c gia cá»¥ thá»ƒ
          description: "Chá»‰ dÃ¹ng khi Táº®T chá»n ngáº«u nhiÃªn. Nháº­p tÃªn quá»‘c gia báº±ng tiáº¿ng Viá»‡t"
          default: "Viá»‡t Nam"
          selector:
            text:
              multiline: false
        
        country_region:
          name: Khu vá»±c Æ°u tiÃªn
          description: Lá»c quá»‘c gia theo khu vá»±c (All = táº¥t cáº£)
          default: all
          selector:
            select:
              options:
                - label: Táº¥t cáº£ (All)
                  value: all
                - label: ChÃ¢u Ã (Asia)
                  value: asia
                - label: ChÃ¢u Ã‚u (Europe)
                  value: europe
                - label: ChÃ¢u Má»¹ (Americas)
                  value: americas
                - label: ChÃ¢u Phi (Africa)
                  value: africa
                - label: ChÃ¢u Äáº¡i DÆ°Æ¡ng (Oceania)
                  value: oceania
              custom_value: false
              sort: false
              multiple: false
    
    reference_image:
      name: "ðŸ–¼ï¸ áº¢nh tham chiáº¿u (Reference Image)"
      icon: mdi:image-outline
      collapsed: true
      input:
        use_reference_image:
          name: Sá»­ dá»¥ng áº£nh tham chiáº¿u
          description: "Báº­t Ä‘á»ƒ Ä‘Ã­nh kÃ¨m áº£nh máº«u. AI sáº½ há»c phong cÃ¡ch chá»¥p, mÃ u sáº¯c, Ã¡nh sÃ¡ng tá»« áº£nh nÃ y.\n\nðŸ’¡ áº¢nh tham chiáº¿u giÃºp:\n- Äá»‹nh hÆ°á»›ng phong cÃ¡ch nhiáº¿p áº£nh\n- Thá»‘ng nháº¥t tone mÃ u vÃ  Ã¡nh sÃ¡ng\n- Táº¡o sá»± nháº¥t quÃ¡n giá»¯a cÃ¡c áº£nh\n"
          default: false
          selector:
            boolean: {}
        
        use_preset_reference:
          name: Sá»­ dá»¥ng áº£nh preset
          description: Chá»n tá»« danh sÃ¡ch áº£nh cÃ³ sáºµn hoáº·c nháº­p Ä‘Æ°á»ng dáº«n tÃ¹y chá»‰nh
          default: true
          selector:
            boolean: {}
        
        preset_reference_path:
          name: ÄÆ°á»ng dáº«n áº£nh preset
          description: "ÄÆ°á»ng dáº«n media-source hoáº·c local path\n\nVÃ­ dá»¥:\n- media-source://media_source/local/calendar/examples.png\n- local/references/style.jpg\n"
          default: "media-source://media_source/local/calendar/examples.png"
          selector:
            text:
              multiline: false
        
        custom_reference_path:
          name: ÄÆ°á»ng dáº«n áº£nh tÃ¹y chá»‰nh
          description: "Nháº­p Ä‘Æ°á»ng dáº«n file áº£nh (chá»‰ dÃ¹ng khi \"Sá»­ dá»¥ng áº£nh preset\" táº¯t)\n\nChá»‰ cáº§n nháº­p: local/folder/tenfile.jpg\n\nVÃ­ dá»¥:\n- local/calendar/examples.png\n- local/references/style.jpg\n- local/my_photos/landscape.jpeg\n\nðŸ’¡ Upload áº£nh vÃ o Media browser trÆ°á»›c khi dÃ¹ng\n"
          default: ""
          selector:
            text:
              multiline: false
    
    ai_settings:
      name: "ðŸ¤– CÃ i Ä‘áº·t AI"
      icon: mdi:robot-outline
      collapsed: false
      input:
        ai_task_entity:
          name: AI Task Entity
          description: Chá»n AI entity há»— trá»£ táº¡o áº£nh (Gemini 2.5 Flash Image recommended)
          selector:
            entity:
              domain:
                - ai_task
              multiple: false
          default: []
        
        image_style:
          name: Phong cÃ¡ch áº£nh
          default: photorealistic
          selector:
            select:
              options:
                - label: áº¢nh chá»¥p chÃ¢n thá»±c (Photorealistic)
                  value: photorealistic
                - label: Phong cÃ¡ch nghá»‡ thuáº­t (Artistic)
                  value: artistic
                - label: Phong cÃ¡ch sá»‘ng Ä‘á»™ng (Vibrant)
                  value: vibrant
                - label: Cinematic Ä‘iá»‡n áº£nh
                  value: cinematic
              custom_value: false
              sort: false
              multiple: false
        
        aspect_ratio:
          name: Tá»· lá»‡ khung hÃ¬nh
          default: "16:9"
          selector:
            select:
              options:
                - label: 16:9 Landscape (Ngang)
                  value: "16:9"
                - label: 9:16 Portrait (Dá»c)
                  value: "9:16"
                - label: 1:1 Square (VuÃ´ng)
                  value: "1:1"
                - label: 4:3 Classic
                  value: "4:3"
                - label: 21:9 Ultra-wide
                  value: "21:9"
              custom_value: false
              sort: false
              multiple: false
        
        include_people:
          name: Cho phÃ©p ngÆ°á»i trong áº£nh
          description: Náº¿u báº­t, cÃ³ thá»ƒ cÃ³ ngÆ°á»i nhá» trong cáº£nh. Náº¿u táº¯t, chá»‰ cÃ³ phong cáº£nh
          default: false
          selector:
            boolean: {}
        
        lighting_preference:
          name: Æ¯u tiÃªn Ã¡nh sÃ¡ng
          default: golden_hour
          selector:
            select:
              options:
                - label: Golden Hour (VÃ ng Ã³ng)
                  value: golden_hour
                - label: Blue Hour (Xanh ma má»‹)
                  value: blue_hour
                - label: Midday (Giá»¯a trÆ°a)
                  value: midday
                - label: Sunset (HoÃ ng hÃ´n)
                  value: sunset
                - label: Sunrise (BÃ¬nh minh)
                  value: sunrise
                - label: Night (Ban Ä‘Ãªm)
                  value: night
                - label: Auto (Tá»± Ä‘á»™ng)
                  value: auto
              custom_value: false
              sort: false
              multiple: false
    
    output_settings:
      name: "ðŸ’¾ CÃ i Ä‘áº·t lÆ°u áº£nh"
      icon: mdi:content-save
      collapsed: true
      input:
        save_image:
          name: LÆ°u áº£nh vÃ o thÆ° má»¥c
          default: true
          selector:
            boolean: {}
        
        output_directory:
          name: ThÆ° má»¥c Ä‘áº§u ra
          default: /media/world_landmarks
          selector:
            text:
              multiline: false
        
        use_fixed_filename:
          name: Sá»­ dá»¥ng tÃªn file cá»‘ Ä‘á»‹nh
          description: Báº­t Ä‘á»ƒ ghi Ä‘Ã¨ file cÅ©
          default: true
          selector:
            boolean: {}
        
        fixed_filename:
          name: TÃªn file cá»‘ Ä‘á»‹nh
          description: TÃªn file khi dÃ¹ng cháº¿ Ä‘á»™ cá»‘ Ä‘á»‹nh
          default: world_landmark_current
          selector:
            text:
              multiline: false
        
        filename_prefix:
          name: Tiá»n tá»‘ tÃªn file
          description: Tiá»n tá»‘ khi táº¡o file má»›i (kÃ¨m timestamp)
          default: landmark_
          selector:
            text:
              multiline: false
        
        file_extension:
          name: Pháº§n má»Ÿ rá»™ng file
          default: png
          selector:
            select:
              options:
                - png
                - jpg
                - jpeg
                - webp
              custom_value: false
              sort: false
              multiple: false
        
        delete_ai_image:
          name: XÃ³a áº£nh AI sau khi lÆ°u
          description: Tá»± Ä‘á»™ng xÃ³a áº£nh do AI táº¡o ra sau khi copy xong
          default: true
          selector:
            boolean: {}
  
  source_url: https://github.com/yourusername/blueprints/world_landmarks_generator.yaml

trigger:
  - platform: time_pattern
    hours: !input trigger_hours

condition: []

action:
  - variables:
      # Country settings
      use_random_country: !input use_random_country
      specific_country: !input specific_country
      country_region: !input country_region
      
      # Complete country lists by region
      asia_countries: >
        ["Viá»‡t Nam", "Nháº­t Báº£n", "HÃ n Quá»‘c", "Trung Quá»‘c", "ThÃ¡i Lan", 
         "Singapore", "Malaysia", "Indonesia", "Philippines", "áº¤n Äá»™", 
         "Nepal", "Bhutan", "Sri Lanka", "MÃ´ng Cá»•", "Myanmar", "Campuchia", 
         "LÃ o", "Bangladesh", "Pakistan", "Uzbekistan", "Kazakhstan"]
      
      europe_countries: >
        ["PhÃ¡p", "Ã", "TÃ¢y Ban Nha", "Bá»“ ÄÃ o Nha", "Thá»¥y SÄ©", "Ão", 
         "Äá»©c", "HÃ  Lan", "Bá»‰", "Anh", "Ireland", "Na Uy", "Thá»¥y Äiá»ƒn", 
         "Pháº§n Lan", "Iceland", "Hy Láº¡p", "Croatia", "SÃ©c", "Ba Lan", 
         "Äan Máº¡ch", "Hungary", "Romania"]
      
      americas_countries: >
        ["Hoa Ká»³", "Canada", "Mexico", "Brazil", "Argentina", "Chile", 
         "Peru", "Colombia", "Ecuador", "Costa Rica", "Cuba"]
      
      africa_countries: >
        ["Ai Cáº­p", "Morocco", "Nam Phi", "Kenya", "Tanzania", "Tunisia", 
         "Ethiopia", "Madagascar", "Namibia"]
      
      oceania_countries: >
        ["Ãšc", "New Zealand", "Fiji", "Papua New Guinea"]
      
      all_countries: >
        {{ (asia_countries | from_json) + (europe_countries | from_json) + 
           (americas_countries | from_json) + (africa_countries | from_json) + 
           (oceania_countries | from_json) }}
      
      # Select country based on settings
      selected_country_list: >
        {% if country_region == 'asia' %}
          {{ asia_countries | from_json }}
        {% elif country_region == 'europe' %}
          {{ europe_countries | from_json }}
        {% elif country_region == 'americas' %}
          {{ americas_countries | from_json }}
        {% elif country_region == 'africa' %}
          {{ africa_countries | from_json }}
        {% elif country_region == 'oceania' %}
          {{ oceania_countries | from_json }}
        {% else %}
          {{ all_countries }}
        {% endif %}
      
      country: >
        {% if use_random_country %}
          {% set arr = selected_country_list %}
          {{ arr[(now().timestamp() | int) % (arr | length)] }}
        {% else %}
          {{ specific_country }}
        {% endif %}
      
      # Reference image settings
      use_reference_image: !input use_reference_image
      use_preset_reference: !input use_preset_reference
      preset_reference_path: !input preset_reference_path
      custom_reference_path: !input custom_reference_path
      
      reference_media_source: >
        {% if use_reference_image %}
          {% if use_preset_reference %}
            {{ preset_reference_path }}
          {% else %}
            {% if custom_reference_path %}
              {% if custom_reference_path.startswith('media-source://') %}
                {{ custom_reference_path }}
              {% else %}
                media-source://media_source/{{ custom_reference_path }}
              {% endif %}
            {% else %}
              
            {% endif %}
          {% endif %}
        {% else %}
          
        {% endif %}
      
      reference_mime_type: >
        {% if reference_media_source %}
          {% set p = reference_media_source | lower %}
          {% if '.png' in p %}
            image/png
          {% elif '.jpg' in p or '.jpeg' in p %}
            image/jpeg
          {% elif '.webp' in p %}
            image/webp
          {% else %}
            image/jpeg
          {% endif %}
        {% else %}
          image/jpeg
        {% endif %}
      
      reference_filename: >
        {% if reference_media_source %}
          {% set parts = reference_media_source.split('/') %}
          {{ parts[-1] if parts else 'reference.jpg' }}
        {% else %}
          reference.jpg
        {% endif %}
      
      reference_folder_path: >
        {% if reference_media_source %}
          {% set full_path = reference_media_source %}
          {% if full_path.startswith('media-source://media_source/') %}
            {% set parts = full_path.replace('media-source://media_source/', '').split('/') %}
            {% if parts | length > 1 %}
              media-source://media_source/{{ parts[:-1] | join('/') }}
            {% else %}
              media-source://media_source
            {% endif %}
          {% else %}
            media-source://media_source
          {% endif %}
        {% else %}
          media-source://media_source
        {% endif %}
      
      # AI settings
      image_style: !input image_style
      aspect_ratio: !input aspect_ratio
      include_people: !input include_people
      lighting_preference: !input lighting_preference
      
      # Aspect ratio descriptions
      aspect_ratio_desc: >
        {% if aspect_ratio == '16:9' %}
          16:9 LANDSCAPE format MANDATORY (width >> height), cinematic widescreen
        {% elif aspect_ratio == '9:16' %}
          9:16 PORTRAIT format MANDATORY (height >> width), vertical mobile-friendly
        {% elif aspect_ratio == '1:1' %}
          1:1 SQUARE format MANDATORY (equal width and height), Instagram-style
        {% elif aspect_ratio == '4:3' %}
          4:3 CLASSIC format (width > height), traditional photography
        {% elif aspect_ratio == '21:9' %}
          21:9 ULTRA-WIDE format (extremely wide), panoramic cinema
        {% else %}
          16:9 landscape format
        {% endif %}
      
      aspect_ratio_prohibition: >
        {% if aspect_ratio == '16:9' %}
          âŒ Portrait format (9:16) âŒ Square format (1:1)
        {% elif aspect_ratio == '9:16' %}
          âŒ Landscape format (16:9) âŒ Square format (1:1)
        {% elif aspect_ratio == '1:1' %}
          âŒ Landscape format (16:9) âŒ Portrait format (9:16)
        {% else %}
          âŒ Wrong aspect ratios
        {% endif %}
      
      # Lighting descriptions
      lighting_desc: >
        {% if lighting_preference == 'golden_hour' %}
          Golden hour lighting: warm, soft sunlight shortly after sunrise or before sunset, long shadows, rich golden tones
        {% elif lighting_preference == 'blue_hour' %}
          Blue hour lighting: twilight atmosphere, deep blue sky, magical ethereal quality, soft diffused light
        {% elif lighting_preference == 'midday' %}
          Midday lighting: bright overhead sun, strong shadows, high contrast, vibrant colors
        {% elif lighting_preference == 'sunset' %}
          Sunset lighting: dramatic warm colors, orange and pink sky, silhouettes, romantic atmosphere
        {% elif lighting_preference == 'sunrise' %}
          Sunrise lighting: fresh morning light, soft pastel colors, dew on surfaces, peaceful beginning-of-day mood
        {% elif lighting_preference == 'night' %}
          Night scene: dark sky with stars or moon, artificial lights creating warm glows, long exposure effect, serene atmosphere
        {% else %}
          Natural lighting appropriate for the location and time of day
        {% endif %}
      
      # Style descriptions
      style_desc: >
        {% if image_style == 'photorealistic' %}
          Photorealistic rendering: natural colors, accurate details, DSLR camera quality, true-to-life representation
        {% elif image_style == 'artistic' %}
          Artistic interpretation: enhanced creative elements, painterly quality, dramatic composition, expressive color grading
        {% elif image_style == 'vibrant' %}
          Vibrant style: saturated colors, high contrast, punchy visuals, Instagram-worthy aesthetic, eye-catching appeal
        {% elif image_style == 'cinematic' %}
          Cinematic quality: film-like color grading, dramatic lighting, professional composition, movie scene aesthetic
        {% else %}
          Professional photography quality
        {% endif %}
      
      # People description
      people_desc: >
        {% if include_people %}
          If people are present, they should be small figures that complement the landscape, not dominate it. No selfies, no modern tourists crowding the frame.
        {% else %}
          NO people visible in the scene. Pure landscape photography without any human presence.
        {% endif %}
      
      # Build optimized prompt
      optimized_prompt: >
        {% if use_reference_image and reference_media_source %}
        ðŸ–¼ï¸ CRITICAL INSTRUCTION - USE PROVIDED REFERENCE IMAGE:
        Use the provided reference image as STYLE GUIDE and COMPOSITION REFERENCE.
        - Match the photographic style, color palette, and mood
        - Apply similar lighting techniques and atmospheric quality
        - Keep the professional quality and attention to detail
        - DO NOT copy the exact scene, only use as inspiration for style
        
        {% endif %}
        ðŸŽ¯ MISSION:
        Create a stunning photograph of the most ICONIC LANDMARK or FAMOUS SCENIC VIEW of {{ country }}.
        This should represent the most recognizable and beautiful location that defines this country.
        
        ðŸ“ CONTENT REQUIREMENTS:
        - Select ONE iconic landmark or natural wonder that is world-famous and represents {{ country }}
        - {{ style_desc }}
        - Cinematic composition with clear foreground, midground, and background depth
        - {{ lighting_desc }}
        - Rich detail and texture throughout the scene
        - {{ people_desc }}
        - Authentic representation of the location's character and atmosphere
        
        ðŸ“ TECHNICAL REQUIREMENTS (MANDATORY):
        - ASPECT RATIO: {{ aspect_ratio_desc }}
        - Professional DSLR quality, sharp focus, appropriate depth of field
        - Proper exposure balanced across entire frame
        - HDR-style dynamic range for maximum detail
        - Natural color accuracy (unless artistic style specified)
        - NO crop marks, NO letterboxing, NO black bars
        
        â›” STRICT PROHIBITIONS:
        {{ aspect_ratio_prohibition }}
        âŒ Text, watermarks, logos, signatures, captions
        âŒ Modern elements that detract (excessive cars, smartphones, commercial signs)
        âŒ Selfie perspective or tourist snapshot aesthetic
        âŒ Busy, cluttered composition
        âŒ Oversaturated or unrealistic colors (unless vibrant style)
        âŒ Blurry, noisy, or low-quality rendering
        
        âœ… FINAL VERIFICATION CHECKLIST:
        âœ“ Correct aspect ratio: {{ aspect_ratio }}
        âœ“ Iconic landmark of {{ country }} clearly featured
        âœ“ Professional photography quality
        âœ“ Appropriate lighting and atmosphere
        âœ“ NO text or watermarks anywhere
        âœ“ Natural, believable scene
        
        Generate the image in {{ aspect_ratio }} format NOW.
      
      task_name: "World Landmark - {{ country }}"
  
  # Generate image with or without reference
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ use_reference_image and reference_media_source != '' }}"
        sequence:
          - action: ai_task.generate_image
            data:
              entity_id: !input ai_task_entity
              task_name: "{{ task_name }}"
              instructions: "{{ optimized_prompt }}"
              attachments:
                media_content_id: "{{ reference_media_source }}"
                media_content_type: "{{ reference_mime_type }}"
                metadata:
                  title: "{{ reference_filename }}"
                  thumbnail: null
                  media_class: image
                  children_media_class: null
                  navigateIds:
                    - {}
                    - media_content_type: app
                      media_content_id: media-source://media_source
                    - media_content_type: ""
                      media_content_id: "{{ reference_folder_path }}"
            response_variable: ai_result
    default:
      - action: ai_task.generate_image
        data:
          entity_id: !input ai_task_entity
          task_name: "{{ task_name }}"
          instructions: "{{ optimized_prompt }}"
        response_variable: ai_result
  
  # Process and save the generated image
  - if:
      - condition: template
        value_template: "{{ ai_result is defined and ai_result.media_source_id is defined }}"
    then:
      - variables:
          source_id: "{{ ai_result.media_source_id }}"
          image_path: >
            {% if source_id.startswith('media-source://ai_task/image/') %}
              /media/ai_task/image/{{ source_id.split('/')[-1] }}
            {% elif source_id.startswith('media-source://') %}
              /media/{{ source_id.replace('media-source://', '').replace('//', '/') }}
            {% else %}
              {{ source_id }}
            {% endif %}
      
      - if:
          - condition: template
            value_template: !input save_image
        then:
          - variables:
              timestamp: "{{ now().strftime('%Y%m%d_%H%M%S') }}"
              use_fixed_filename: !input use_fixed_filename
              fixed_filename: !input fixed_filename
              output_directory: !input output_directory
              filename_prefix: !input filename_prefix
              file_extension: !input file_extension
              delete_ai_image: !input delete_ai_image
              
              filename: >
                {% if use_fixed_filename %}
                  {{ fixed_filename }}.{{ file_extension }}
                {% else %}
                  {{ filename_prefix }}{{ country | replace(' ', '_') | lower }}_{{ timestamp }}.{{ file_extension }}
                {% endif %}
              
              dest_path: "{{ output_directory }}/{{ filename }}"
          
          - action: shell_command.copy_world_landmark_image
            data:
              source: "{{ image_path }}"
              destination: "{{ dest_path }}"
          
          - if:
              - condition: template
                value_template: "{{ delete_ai_image }}"
            then:
              - action: delete.file
                data:
                  file: "{{ image_path }}"
                continue_on_error: true

mode: single
max_exceeded: silent